---
title: æ•°æ®ç»“æ„
---

!!! tip
    æ•°æ®ç»“æ„åªæ˜¯ä¸€ç§æ‰‹æ®µï¼Œä¸èƒ½ä¸ç®—æ³•å‰²è£‚ã€‚å› æ­¤æœ¬æ–‡è¾ƒå¤šå†…å®¹å…¶å®ä½¿ç”¨äº† [åŠ¨æ€è§„åˆ’](./dp.md)ã€[å›¾è®º](./graph.md) å’Œ [å­—ç¬¦ä¸²](./string.md) ç­‰ç®—æ³•ï¼Œè‹¥é‡åˆ°éš¾ä»¥ç†è§£çš„éƒ¨åˆ†ï¼Œå»ºè®®æå‰å­¦ä¹ å¯¹åº”ç®—æ³•çš„ç†è®ºä¸ä¾‹é¢˜ã€‚

æ•°æ®ç»“æ„ç”±ã€Œæ•°æ®ã€å’Œã€Œç»“æ„ã€ä¸¤éƒ¨åˆ†ç»„æˆï¼Œæˆ‘ä»¬ä¸»è¦è®¨è®ºåè€…ã€‚æŒ‰ç…§é€»è¾‘ï¼Œå¯ä»¥å°†æ•°æ®ç»“æ„åˆ’åˆ†ä¸ºã€Œçº¿æ€§ç»“æ„ã€å’Œã€Œéçº¿æ€§ç»“æ„ã€ä¸¤ç§ã€‚ä¸‹å›¾å±•ç¤ºäº†éƒ¨åˆ†åˆ†ç±»ç»“æœï¼š

![çº¿æ€§æ•°æ®ç»“æ„ vs. éçº¿æ€§æ•°æ®ç»“æ„](https://cdn.dwj601.cn/images/202408301527018.png)

åœ¨é¢å¯¹ä¸€ä¸ªå®é™…é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦è€ƒè™‘ä¸¤ä¸ªé—®é¢˜ï¼šéœ€è¦å­˜å‚¨ä»€ä¹ˆä¿¡æ¯ï¼Ÿä»¥åŠä¿¡æ¯ä¹‹é—´çš„ç»„ç»‡æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿä¸€èˆ¬è€Œè¨€ï¼Œå­˜å‚¨çš„éƒ½æ˜¯æ•°å€¼æ•°æ®æˆ–è€…æ•°æ®ä¹‹é—´çš„å…³ç³»ï¼Œç»„ç»‡æ–¹å¼æœ‰çº¿æ€§ç»“æ„ã€æ ‘å½¢ç»“æ„ã€å›¾ç»“æ„å…±ä¸‰ç§ï¼ˆæœ‰äº›æ•™æä¼šå•ç‹¬æŠŠé›†åˆæ‹¿å‡ºæ¥ï¼Œä½†ç”±äºé›†åˆçš„é€»è¾‘ä¸€èˆ¬éƒ½é€šè¿‡æ ‘æˆ–å›¾æ¥å®ç°ï¼Œå› æ­¤è¿™é‡Œä¸å•ç‹¬ç½—åˆ—ï¼‰ã€‚

## é“¾è¡¨

ç›¸è¾ƒäºé¡ºåºè¡¨ï¼ˆæ•°ç»„ï¼‰åœ¨å†…å­˜ä¸Šè¿ç»­å­˜åœ¨ï¼Œé“¾è¡¨å› å…¶ç‹¬ç‰¹çš„ç»“æ„åœ¨å†…å­˜ä¸Šçš„åˆ†æ•£å­˜åœ¨çš„ï¼Œè¿™å°±ä½¿å¾—é“¾è¡¨æœ‰ç€ä¸€äº›ç‹¬ç‰¹çš„æ€§è´¨ï¼š

1. é¡ºåºè¡¨å¯ä»¥ $O(1)$ è®¿é—®ï¼Œä½†æ˜¯éœ€è¦ $O(n)$ æ’å…¥ä¸åˆ é™¤ï¼›
2. è€Œé“¾è¡¨éœ€è¦ $O(n)$ è®¿é—®ï¼Œä½†åªéœ€è¦ $O(1)$ æ’å…¥ä¸åˆ é™¤ã€‚

å¸¸è§çš„é“¾è¡¨ç»“æ„æœ‰ã€Œå•é“¾è¡¨ã€å¾ªç¯é“¾è¡¨ã€åŒå‘é“¾è¡¨ã€ä¸‰ç§ï¼Œé“¾è¡¨ä¸­æ¯ä¸ªç»“ç‚¹åªæœ‰ä¸€ä¸ªå‰é©±ç»“ç‚¹å’Œä¸€ä¸ªåç»§ç»“ç‚¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºäº†ä¾¿äºç¼–ç ï¼Œéƒ½ä¼šæå‰è®¾ç½®ç©ºç»“ç‚¹ï¼Œä¾‹å¦‚ï¼šå•é“¾è¡¨ä¼šè®¾ç½®ä¸€ä¸ªç©ºçš„å¤´ç»“ç‚¹ï¼Œå¾ªç¯é“¾è¡¨ä¼šè®¾ç½®ä¸€ä¸ªç©ºçš„å°¾ç»“ç‚¹ï¼ŒåŒå‘é“¾è¡¨åˆ™ä¼šè®¾ç½®ä¸€ä¸ªç©ºçš„å¤´ç»“ç‚¹å’Œä¸€ä¸ªç©ºçš„å°¾ç»“ç‚¹ã€‚

å¯¹äºé“¾è¡¨ä¸Šçš„å¢åˆ æ”¹æŸ¥ï¼Œæ”¹å’ŒæŸ¥ç›´æ¥é“¾å¼éå†å³å¯ï¼Œå”¯ä¸€éš¾ç‚¹å°±æ˜¯å¢å’Œåˆ ã€‚ä¸‹é¢ä»¥åŒå‘é“¾è¡¨ä¸ºä¾‹è®²è®²ç»“ç‚¹çš„åˆ é™¤å’Œæ·»åŠ æ“ä½œï¼š

1ï¼‰åŒå‘é“¾è¡¨ç»“ç‚¹æ·»åŠ 

![åŒå‘é“¾è¡¨ç»“ç‚¹æ·»åŠ ](https://cdn.dwj601.cn/images/202406292218514.png)

```cpp
s->prior = p;
s->next = p->next;
p->next->prior = s;
p->next = s;
```

2ï¼‰åŒå‘é“¾è¡¨ç»“ç‚¹åˆ é™¤

![åŒå‘é“¾è¡¨ç»“ç‚¹åˆ é™¤](https://cdn.dwj601.cn/images/202406292218515.png)

```cpp
p->prior->next = p->next;
p->next->prior = p->prior;
```

## æ ˆ

æ ˆæ˜¯ä¸€ç§ã€Œå…ˆè¿›åå‡ºã€å‹çº¿æ€§æ•°æ®ç»“æ„ã€‚åˆ†ä¸ºé¡ºåºæ ˆå’Œé“¾æ ˆï¼Œé¡ºåºæ ˆå°±æ˜¯æ•°ç»„æ¨¡æ‹Ÿï¼Œé“¾æ ˆå°±ç±»ä¼¼äºå¤´æ’æ³•çš„å•é“¾è¡¨ï¼Œç»“æ„éƒ½å¾ˆç®€å•ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨æ ˆçš„ç®—æ³•ã€‚æ ˆçš„ç®—æ³•éƒ½å¾ˆæœ‰è¶£ï¼Œä¸»è¦æœ‰ä¸‰ç±»ï¼šè¿›å‡ºæ ˆé¡ºåºé—®é¢˜ã€è¡¨è¾¾å¼æ±‚å€¼é—®é¢˜ã€å•è°ƒæ ˆé—®é¢˜ï¼Œä»¥åŠä¸€äº›åˆ©ç”¨æ ˆç»“æ„çš„æ€ç»´é¢˜ã€‚

### ä¾‹ï¼šéªŒè¯æ ˆåºåˆ—

> ç»å…¸ä¹‹å¤„ï¼šè¿›å‡ºæ ˆé¡ºåºé—®é¢˜
>
> éš¾åº¦ï¼šæ´›è°· é»„
>
> OJï¼š[æ´›è°·](https://www.luogu.com.cn/problem/P4387)

é¢˜æ„ï¼šç»™å®šä¸¤ä¸ªé•¿åº¦ä¸º $n\ (1\le n\le 10^5)$ çš„æ’åˆ— $a,b$ï¼Œè‹¥ $a$ è¡¨ç¤ºå…¥æ ˆåºåˆ—ï¼Œåˆ™ $b$ è¡¨ç¤ºçš„å‡ºæ ˆåºåˆ—æ˜¯å¦åˆæ³•ï¼Œåˆæ³•è¾“å‡º Yesï¼Œä¸åˆæ³•è¾“å‡º Noã€‚

æ€è·¯ï¼šå¯¹äºæ¯ä¸€ä¸ªå…¥æ ˆå…ƒç´ ï¼Œåªæœ‰ä¸¤ç§çŠ¶æ€ï¼Œè¦ä¹ˆå…¥æ ˆåç«‹å³å‡ºæ ˆï¼Œè¦ä¹ˆè¢«å‹å…¥ç­‰å¾…åå…¥æ ˆçš„å…ƒç´ å‡ºæ ˆæ—¶å°†å…¶ä¸€èµ·å¸¦å‡ºã€‚è¿™ä¸¤ç§çŠ¶æ€å¯ä»¥å½’çº³ä¸ºï¼Œä¸€æ—¦å…¥æ ˆå…ƒç´ ä¸å‡ºæ ˆå…ƒç´ ç›¸ç­‰ï¼Œå°±å¯ä»¥å¯¹ä¸€ä¸ªè¿ç»­åºåˆ—è¿›è¡ŒåŒ¹é…ï¼Œå…¶ä¸­å¯¹å…¥æ ˆå…ƒç´ æ˜¯ä»åå¾€å‰é€†åºåŒ¹é…ï¼ˆå¯ä»¥ç”¨æ ˆæ¨¡æ‹Ÿï¼‰ï¼Œå¯¹å‡ºæ ˆå…ƒç´ æ˜¯ä»å‰å¾€åé¡ºåºåŒ¹é…ï¼ˆå¯ä»¥ç”¨æ•°ç»„ + æŒ‡é’ˆæ¨¡æ‹Ÿï¼‰ï¼Œä¸æ–­é‡å¤ç›´åˆ°æšä¸¾å®Œæ‰€æœ‰å…¥æ ˆå…ƒç´ ï¼Œå¦‚æœæ‰€æœ‰å…ƒç´ éƒ½åŒ¹é…ä¸Šäº†è¡¨æ˜å‡ºæ ˆåºåˆ—æ˜¯åˆæ³•çš„ï¼Œåä¹‹ä¸åˆæ³•ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ï¼Œæ¯ä¸ªå…ƒç´ åªä¼šç»å†å…¥æ ˆå’Œå‡ºæ ˆä¸¤ç§æƒ…å†µï¼Œæ•…æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§çš„ã€‚

=== "Python"

    ```python
    for _ in range(int(input().strip())):
    
        n = int(input().strip())
        a = list(map(int, input().strip().split()))
        b = list(map(int, input().strip().split()))
    
        stk = []
        j = 0
        for x in a:
            stk.append(x)
            while len(stk) and stk[-1] == b[j]:
                stk.pop()
                j += 1
    
        print('No' if len(stk) else 'Yes')
    ```

=== "C++"

    ```cpp
    #include <iostream>
    #include <stack>
    #include <vector>
    using namespace std;
    
    void solve() {
        int n;
        cin >> n;
    
        vector<int> a(n), b(n);
        for (int i = 0; i < n; i++) {
            cin >> a[i];
        }
        for (int i = 0; i < n; i++) {
            cin >> b[i];
        }
    
        stack<int> stk;
        for (int i = 0, j = 0; i < n; i++) {
            stk.push(a[i]);
            while (stk.size() && stk.top() == b[j]) {
                stk.pop();
                j++;
            }
        }
    
        cout << (stk.size() ? "No" : "Yes") << "\n";
    }
    
    int main() {
        int T;
        cin >> T;
        while (T--) {
            solve();
        }
        return 0;
    }
    ```

**å¡ç‰¹å…°æ•°**ã€‚è‹¥æœ‰ $n$ ä¸ªå…ƒç´ æŒ‰ç…§æŸç§é¡ºåºå‹å…¥æ ˆä¸­ä¸”å¯åœ¨ä»»æ„æ—¶åˆ»å¼¹å‡ºæ—¶ï¼Œåˆ™å¯èƒ½çš„å‡ºæ ˆåºåˆ—ä¸ªæ•°å¯ç”¨å¡ç‰¹å…°æ•°è®¡ç®—ï¼Œå³ $\frac{1}{n+1} C_{2n}^{n}$ã€‚

æ¨å¯¼è¿‡ç¨‹å¯ä»¥ç”¨åŠ¨æ€è§„åˆ’çš„æ€æƒ³è¿›è¡Œï¼šå®šä¹‰ $f(k)$ è¡¨ç¤ºåœ¨ç¬¬ $k$ ä¸ªæ•°æ˜¯æœ€åä¸€ä¸ªå‡ºæ ˆçš„æƒ…å†µä¸‹å‡ºæ ˆåºåˆ—çš„æ€»ä¸ªæ•°ï¼Œåˆ™ $f(k)=f(k-1)f(n-k)$ï¼Œå…¶ä¸­ $f(0)=1$ã€‚é‚£ä¹ˆå¡ç‰¹å…°æ•°çš„æ¨å¯¼å…¬å¼å°±æ˜¯ï¼š

$$
\sum_{k = 1}^{n} f(k) = \sum_{k = 1}^{n} f(k-1) f(n-k)=\frac{1}{n+1} C_{2n}^{n}
$$

### ä¾‹ï¼šè¡¨è¾¾å¼æ±‚å€¼ğŸ¤¨

åˆ†ä¸ºå‰ç¼€ã€ä¸­ç¼€å’Œåç¼€ä¸‰ç§è¡¨è¾¾å¼ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹æ ‘çš„ä¸€ç§éå†ã€‚å…·ä½“åœ°ï¼š

- ä¸­ç¼€è¡¨è¾¾å¼æ±‚å€¼ã€‚ã€ŒåŒæ ˆã€æ€è·¯ï¼Œç®—ç¬¦ä¼˜å…ˆæ³•ï¼š
    - é‡åˆ°æ•°å­—ï¼Œç›´æ¥å…¥æ•°æ ˆï¼›
    - é‡åˆ°ç¬¦å·ï¼š
        - å¦‚æœæ˜¯æ‹¬å·ï¼Œå·¦æ‹¬å·ç›´æ¥å…¥æ ˆï¼Œå³æ‹¬å·è¿›è¡Œè¿ç®—ç›´åˆ°é‡åˆ°å·¦æ‹¬å·ï¼›
        - å¦‚æœæ˜¯ç®—ç¬¦ï¼Œåœ¨å…¥ç®—ç¬¦æ ˆä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œè¿ç®—æ“ä½œç›´åˆ°ç®—ç¬¦æ ˆé¡¶å…ƒç´ ç­‰çº§å°äºå½“å‰ç®—ç¬¦ç­‰çº§ã€‚
- ä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€è¡¨è¾¾å¼ã€‚ã€Œç®—ç¬¦æ ˆã€å³å¯ï¼Œåç¼€å…ˆé‡åˆ°å°±ç›´æ¥è®¡ç®—çš„è¿ç®—ç¬¦ $\to$ ä¸­ç¼€è¡¨è¾¾å¼éœ€è¦å…ˆç®—çš„è¿ç®—ç¬¦ï¼Œäºæ˜¯è½¬åŒ–æ€è·¯å°±æ˜¯ï¼š
    - é‡åˆ°æ•°å­—ï¼Œç›´æ¥æ„é€ åç¼€è¡¨è¾¾å¼ï¼›
    - é‡åˆ°ç®—ç¬¦ï¼š
        - å¦‚æœæ˜¯æ‹¬å·ï¼Œå·¦æ‹¬å·ç›´æ¥å…¥æ ˆï¼Œå³æ‹¬å·è¿›è¡Œåç¼€è¡¨è¾¾å¼æ„é€ ç›´åˆ°é‡åˆ°å·¦æ‹¬å·ï¼›
        - å¦‚æœæ˜¯ç®—ç¬¦ï¼Œåœ¨å…¥ç®—ç¬¦æ ˆä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œåç¼€è¡¨è¾¾å¼æ„é€ æ“ä½œç›´åˆ°ç®—ç¬¦æ ˆé¡¶å…ƒç´ ç­‰çº§å°äºå½“å‰ç®—ç¬¦ç­‰çº§ã€‚
- åç¼€è¡¨è¾¾å¼æ±‚å€¼ã€‚ã€Œæ•°æ ˆã€å³å¯ï¼š
    - é‡åˆ°æ•°å­—ç›´æ¥å…¥æ•°æ ˆï¼›
    - é‡åˆ°ç®—ç¬¦ç›´æ¥è¿›è¡Œè¿ç®—ã€‚

### ä¾‹ï¼šå•è°ƒæ ˆ

> ç»å…¸ä¹‹å¤„ï¼šå•è°ƒé€’å‡æ ˆæ¿å­é¢˜
>
> OJï¼š[AcWing](https://www.acwing.com/problem/content/832/)ï¼Œæ³¨æ„ï¼Œè¯¥ OJ éœ€è¦ä»˜è´¹ï¼Œä½†æ€æƒ³å¾ˆç®€å•ï¼Œç†è§£æ¿å­åå°è¯•åŒç±»é¢˜å³å¯ã€‚
>
> éš¾åº¦ï¼šCF 1300 *

é¢˜æ„ï¼šç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $n\ (1\le n\le 10^5)$ çš„åºåˆ— $a\ (1\le a_i\le 10^9)$ï¼Œå¯»æ‰¾åºåˆ—æ¯ä¸€ä¸ªå…ƒç´ å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”å…¶å°çš„å…ƒç´ ï¼Œä¸å­˜åœ¨å°±è¾“å‡º $-1$ã€‚

æ€è·¯ï¼š

- æ˜¾ç„¶ç›´æ¥åŒé‡å¾ªç¯æ˜¯æ— æ³•é€šè¿‡æœ¬é¢˜çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨ç¬¬äºŒå±‚å¾ªç¯çš„å€’åºéå†ä¸­å°‘æšä¸¾ä¸€äº›å…ƒç´ å—ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚å¯¹äº $a_i$ï¼Œæˆ‘ä»¬å°†ã€Œ$a_{0\sim i-1}$ ä¸­æ¯”å½“å‰å…ƒç´ å°çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€è®°ä¸ºã€Œåˆæ³•å¯¹è±¡ã€ï¼›
- æ­£å‘è€ƒè™‘ä¼¼ä¹æœ‰äº›å›°éš¾ï¼Œæˆ‘ä»¬ä¸å¦¨é€†å‘æ€è€ƒï¼šå½“å‰å…ƒç´ å¦‚ä½•æ‰èƒ½æˆä¸ºåç»­å…ƒç´ çš„åˆæ³•å¯¹è±¡ï¼Ÿæ˜¾ç„¶çš„ï¼Œå¦‚æœ $a_i$ å¯ä»¥æˆä¸ºåç»­å…ƒç´ çš„åˆæ³•å¯¹è±¡ï¼Œé‚£ä¹ˆ $a_{0\sim i-1}$ ä¸­å¤§äºï¼ˆå¤§äºç­‰äºï¼‰$a_i$ çš„æ•°éƒ½æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ã€‚åŸºäºè¯¥æ€æƒ³ï¼Œå¯ä»¥å‘ç°ä¿ç•™ä¸‹æ¥çš„å…ƒç´ å‘ˆï¼ˆä¸¥æ ¼ï¼‰å•è°ƒé€’å¢çš„è¶‹åŠ¿ï¼›
- å¦‚ä½•åœ¨æ­£å‘éå†æ—¶ç»´æŠ¤ä¸€ä¸ªä¸¥æ ¼å•è°ƒé€’å¢åºåˆ—ï¼Ÿè¿™å°±å¾ˆç®€å•äº†ï¼Œæ”¯æŒå°¾æ’å…¥å’Œå°¾å¼¹å‡ºçš„æ•°æ®ç»“æ„å°±å¯ä»¥æ»¡è¶³ï¼Œè€Œè¿™éæ ˆè«å±ï¼Œä¹Ÿæ­£å› ä¸ºè¿™é‡Œçš„æ ˆç»´æŠ¤çš„æ˜¯å•è°ƒåºåˆ—ï¼Œä¹Ÿå°±æœ‰äº†ã€Œå•è°ƒæ ˆã€ä¸€è¯´ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç®—æ³•æ€æƒ³ï¼›
- æœ€åï¼Œå¦‚ä½•å¯»æ‰¾åˆæ³•å¯¹è±¡ï¼ŸæŒ‰ç…§ç»´æŠ¤é€’å¢åºåˆ—çš„é€»è¾‘ï¼Œä»å°¾éƒ¨å¼€å§‹é€ä¸ªæ¯”è¾ƒå³å¯ï¼Œå¦‚æœåˆæ³•å°±æ˜¯ç­”æ¡ˆï¼Œå¦‚æœä¸åˆæ³•å°±å–è€Œä»£ä¹‹ç›´åˆ°æ ˆç©ºï¼›
- ç”±äºæ¯ä¸€ä¸ªå…ƒç´ æœ€å¤šåªä¼šç»å†ã€Œå…¥æ ˆã€å’Œã€Œå‡ºæ ˆã€ä¸¤ç§æƒ…å†µï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§çš„ï¼Œå¯ä»¥é€šè¿‡æœ¬é¢˜ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$

=== "Python"

    ```python
    n = int(input().strip())
    a = list(map(int, input().strip().split()))
    
    stk = []
    OUTs = []
    for x in a:
        # æŸ¥è¯¢
        while len(stk) and x <= stk[-1]:  # åŠ ä¸Šç­‰å·è¡¨ç¤ºä¿æŒä¸¥æ ¼å•è°ƒ
            stk.pop()
        OUTs.append(-1 if len(stk) == 0 else stk[-1])
        
        # å…¥æ ˆ
        stk.append(x)
    
    print(' '.join(map(str, OUTs)))
    ```

=== "C++"

    ```cpp
    #include <iostream>
    #include <stack>
    using namespace std;
    
    int main() {
        int n;
        cin >> n;
    
        stack<int> stk;
        for (int i = 0; i < n; i++) {
            int x;
            cin >> x;
    
            // æŸ¥è¯¢
            while (stk.size() && x <= stk.top()) {  // åŠ ä¸Šç­‰å·è¡¨ç¤ºä¿æŒä¸¥æ ¼å•è°ƒ
                stk.pop();
            }
            cout << (stk.size() ? stk.top() : -1) << " ";
    
            // å…¥æ ˆ
            stk.push(x);
        }
    
        return 0;
    }
    ```

åŒç±»é¢˜æ¨èï¼š

- [CF 1400 * | ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II | åŠ›æ‰£ - (leetcode.cn)](https://leetcode.cn/problems/next-greater-element-ii/)

## é˜Ÿåˆ—

é˜Ÿåˆ—æ˜¯ä¸€ç§ã€Œå…ˆè¿›å…ˆå‡ºã€å‹çº¿æ€§æ•°æ®ç»“æ„ã€‚åˆ†ä¸ºé¡ºåºé˜Ÿåˆ—å’Œé“¾å¼é˜Ÿåˆ—ï¼Œé¡ºåºé˜Ÿåˆ—å°±æ˜¯æ•°ç»„æ¨¡æ‹Ÿï¼Œé“¾å¼é˜Ÿåˆ—å°±ç±»ä¼¼äºåŒå‘é“¾è¡¨ã€‚ä¸æ ˆç±»ä¼¼ï¼Œé˜Ÿåˆ—çš„ç»“æ„ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ä½¿ç”¨é˜Ÿåˆ—çš„ç®—æ³•ã€‚æ¯”è¾ƒå¸¸è§çš„åˆ©ç”¨é˜Ÿåˆ—çš„ç®—æ³•æ¯”å¦‚ï¼šå‡ºé˜Ÿé¡ºåºé—®é¢˜ã€BFSã€å•è°ƒé˜Ÿåˆ—ç­‰ã€‚

### ä¾‹ï¼šå•è°ƒé˜Ÿåˆ—

> ç»å…¸ä¹‹å¤„ï¼šå•è°ƒé˜Ÿåˆ—é€šæ³•ï¼Œå­¦ä¹ ä¹‹å‰è¯·åŠ¡å¿…å­¦ä¹  [å•è°ƒæ ˆ](#ä¾‹å•è°ƒæ ˆ) ç®—æ³•ã€‚
>
> OJï¼š[AcWing](https://www.acwing.com/problem/content/156/)ï¼Œæ³¨æ„ï¼Œè¯¥ OJ éœ€è¦ä»˜è´¹ï¼Œä½†æ€æƒ³å¾ˆç®€å•ï¼Œç†è§£æ¿å­åå°è¯•åŒç±»é¢˜å³å¯ã€‚
>
> éš¾åº¦ï¼šCF 1400 *

é¢˜æ„ï¼šç»™å®šä¸€ä¸ªå«æœ‰ $n\ (1\le n\le 10^6)$ ä¸ªå…ƒç´ çš„åºåˆ— $a\ (-10^5\le a_i\le 10^5)$ï¼Œæ±‚è§£å…¶ä¸­æ¯ä¸ªçª—å£å¤§å°ä¸º $k\ (1\le k\le n)$ çš„å­æ•°ç»„ä¸­çš„æœ€å€¼ã€‚

æ€è·¯ï¼šæ˜¾ç„¶æˆ‘ä»¬å¯ä»¥ $O(nk)$ æš´åŠ›æ±‚è§£ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥å°†ã€Œæ±‚è§£å­æ•°ç»„ä¸­æœ€å€¼ã€çš„æ—¶é—´å¼€é”€ä» $O(k)$ é™ä½ä¸º $O(1)$ å‘¢ï¼Ÿæœ‰çš„ï¼å¦‚æœçª—å£ä¸­çš„å…ƒç´ æ˜¯å•è°ƒçš„ï¼Œé‚£ä¹ˆæ±‚è§£æœ€å€¼ä¸å°±æ˜¯ $O(1)$ çš„äº†å˜›ï¼å¦‚ä½•ç»´æŠ¤ä¸€ä¸ªå•è°ƒåºåˆ—å·²ç»åœ¨å•è°ƒæ ˆæ•°æ®ç»“æ„ä¸­è¯¦ç»†é˜æ˜ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ï¼Œé‡ç‚¹è®²è§£ä¸å•è°ƒæ ˆçš„ä¸åŒä¹‹å¤„ï¼š

1. ç”±äºæ˜¯æ»‘åŠ¨çª—å£ï¼Œå› æ­¤æ­¤å¤„çš„å•è°ƒåºåˆ—ä¸ä»…è¦æ”¯æŒå°¾æ’å…¥æ“ä½œï¼Œè¿˜å¾—æ”¯æŒå¤´å¼¹å‡ºæ“ä½œã€‚è¿™ä¹Ÿå¥½åŠï¼Œåœ¨çª—å£åˆ’å‡ºå…ƒç´  $a_{i-k}$ æ—¶ï¼Œåªéœ€è¦å¼¹å‡ºå•è°ƒåºåˆ—ä¸­çš„ $a_{i-k}$ å³å¯ã€‚ç”±äºåºåˆ—çš„å°¾æ’å…¥æ“ä½œä¼šå¼¹å‡ºæ‰€æœ‰ã€Œé€†å•è°ƒã€çš„å…ƒç´ ï¼Œå› æ­¤å¦‚æœå¤´å¼¹å‡ºçœŸçš„å¼¹å‡ºå…ƒç´ äº†ï¼Œé‚£ä¹ˆå¼¹å‡ºçš„å…ƒç´ ä¸€å®šæ˜¯åŸçª—å£çš„æœ€å€¼ã€‚ä¸ºäº†æ”¯æŒå¤´å¼¹å‡ºå’Œå°¾æ’å…¥æ“ä½œï¼ŒåŒç«¯é˜Ÿåˆ—å°±æ˜¯æœ€ä½³é€‰é¡¹ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™ç§çª—å£æ±‚æœ€å€¼çš„ç®—æ³•è¢«ç§°ä¸ºã€Œå•è°ƒé˜Ÿåˆ—ã€äº†ï¼›
2. å¦å¤–ä¸€ä¸ªä¸å•è°ƒæ ˆä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå…ˆå°¾æ’å…¥è¿˜æ˜¯å…ˆå¤´å¼¹å‡ºï¼Ÿè¿™å…¶å®æ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£çš„é—®é¢˜ï¼Œå¦‚æœå¯ä»¥ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆè¿™ä¸ªç®—æ³•ä½ åŸºæœ¬å°±ç®—æ˜¯ç†è§£äº†ã€‚ç†è®ºä¸Šè¿™ä¸¤è€…è°å…ˆè°åéƒ½æ˜¯å¯è¡Œçš„ã€‚ä½†å¦‚æœåœ¨å°¾æ’å…¥æ—¶ä¿æŒäº†ä¸¥æ ¼å•è°ƒï¼Œæ­¤æ—¶å°±å¿…é¡»å…ˆå¤´å¼¹å‡ºå†å°¾æ’å…¥ï¼Œå› ä¸ºå¯èƒ½å‡ºç°çš„æç«¯æƒ…å†µå°±æ˜¯ï¼šçª—å£ä¸­çš„æœ€å€¼å°±æ˜¯ $a_i$ å¹¶ä¸” $a_i=a_{i-k}$ï¼Œå¦‚æœå…ˆå°¾æ’å…¥ï¼Œé˜Ÿåˆ—ä¸­å°±åªå‰© $a_i$ ä¸€ä¸ªå…ƒç´ ï¼Œå†æ‰§è¡Œå¤´å¼¹å‡ºçš„è¯å°±æŠŠè¿™å”¯ä¸€çš„å…ƒç´ å¼¹æ‰äº†ï¼Œä½†å…¶å®è¢«å¼¹æ‰çš„å…ƒç´ å·²ç»åœ¨ $a_i$ æ’å…¥æ—¶æå‰å¼¹æ‰äº†ã€‚æ‰€ä»¥ä¿é™©èµ·è§ï¼Œè¿˜æ˜¯å°†å°¾æ’å…¥çš„é€»è¾‘é™å®šä¸ºä¸ä¸¥æ ¼å•è°ƒå§ ~

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ï¼ŒåŸç†ä¸å•è°ƒæ ˆä¸€è‡´ï¼Œæ¯ä¸ªå…ƒç´ éƒ½åªä¼šç»å†å…¥é˜Ÿå’Œå‡ºé˜Ÿä¸¤ç§æƒ…å†µï¼Œæ•…å¤æ‚åº¦æ˜¯çº¿æ€§çš„ã€‚

=== "Python"

    ```python
    from collections import deque
    
    class MonotonicQueue:
        def __init__(self, min_queue: bool = True):
            self.q = deque()
            if min_queue:
                # é˜Ÿå¤´ä¸ºæœ€å°å€¼ï¼šä¸ä¸¥æ ¼å•è°ƒé€’å¢é˜Ÿåˆ—
                self.compare = lambda a, b: a < b
            else:
                # é˜Ÿå¤´ä¸ºæœ€å¤§å€¼ï¼šä¸ä¸¥æ ¼å•è°ƒé€’å‡é˜Ÿåˆ—
                self.compare = lambda a, b: a > b
    
        def push_back(self, x):
            while len(self.q) and self.compare(x, self.q[-1]):
                self.q.pop()
            self.q.append(x)
    
        def pop_left(self, x):
            if len(self.q) and x == self.q[0]:
                self.q.popleft()
    
        def get_extreme_value(self):
            return self.q[0]
    
    n, k = map(int, input().strip().split())
    a = list(map(int, input().strip().split()))
    
    min_outs, max_outs = [], []
    minq, maxq = MonotonicQueue(True), MonotonicQueue(False)
    for i in range(n):
        # å°¾æ’å…¥
        minq.push_back(a[i])
        maxq.push_back(a[i])
    
        # å¤´å¼¹å‡º
        if i - k >= 0:
            minq.pop_left(a[i - k])
            maxq.pop_left(a[i - k])
    
        # å–æå€¼
        if i >= k - 1:
            min_outs.append(minq.get_extreme_value())
            max_outs.append(maxq.get_extreme_value())
    
    print(' '.join(map(str, min_outs)))
    print(' '.join(map(str, max_outs)))
    ```

=== "C++"

    ```c++
    #include <deque>
    #include <iostream>
    #include <functional>
    #include <vector>
    using namespace std;
    
    template<class T>
    struct MonotonicQueue {
        deque<T> q;
        function<bool(T, T)> compare;
    
        MonotonicQueue(bool min_queue) {
            if (min_queue) {
                // é˜Ÿå¤´ä¸ºæœ€å°å€¼ï¼šä¸ä¸¥æ ¼å•è°ƒé€’å¢é˜Ÿåˆ—
                compare = [](T a, T b) { return a < b; };
            } else {
                // é˜Ÿå¤´ä¸ºæœ€å¤§å€¼ï¼šä¸ä¸¥æ ¼å•è°ƒé€’å‡é˜Ÿåˆ—
                compare = [](T a, T b) { return a > b; };
            }
        }
    
        void push_back(T x) {
            while (q.size() && compare(x, q.back())) {
                q.pop_back();
            }
            q.push_back(x);
        }
    
        void pop_front(T x) {
            if (q.size() && x == q.front()) {
                q.pop_front();
            }
        }
    
        T get_extreme_value() {
            return q.front();
        }
    };
    
    int main() {
        int n, k;
        cin >> n >> k;
    
        vector<int> a(n);
        for (int i = 0; i < n; i++) {
            cin >> a[i];
        }
    
        // æ±‚çª—å£æœ€å°å€¼
        MonotonicQueue<int> minq(true);
        for (int i = 0; i < n; i++) {
            // å°¾æ’å…¥
            minq.push_back(a[i]);
    
            // å¤´å¼¹å‡º
            if (i - k >= 0) {
                minq.pop_front(a[i - k]);
            }
    
            // å–æå€¼
            if (i >= k - 1) {
                cout << minq.get_extreme_value() << " \n"[i == n - 1];
            }
        }
    
        // æ±‚çª—å£æœ€å¤§å€¼
        MonotonicQueue<int> maxq(false);
        for (int i = 0; i < n; i++) {
            // å°¾æ’å…¥
            maxq.push_back(a[i]);
    
            // å¤´å¼¹å‡º
            if (i - k >= 0) {
                maxq.pop_front(a[i - k]);
            }
    
            // å–æå€¼
            if (i >= k - 1) {
                cout << maxq.get_extreme_value() << " \n"[i == n - 1];
            }
        }
    
        return 0;
    }
    ```

åŒç±»é¢˜æ¨èï¼š

- [CF 1300 * | é¢„ç®—å†…çš„æœ€å¤šæœºå™¨äººæ•°ç›® | åŠ›æ‰£ - (leetcode.cn)](https://leetcode.cn/problems/maximum-number-of-robots-within-budget/description/)

## å“ˆå¸Œè¡¨

å“ˆå¸Œæ˜¯ä¸€ç§åº”ç”¨æå…¶å¹¿æ³›çš„ç®—æ³•ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½ä¸ºï¼š**ç»™å®šä»»æ„ä¸€ä¸ªå¯¹è±¡ Aï¼Œèƒ½åˆ©ç”¨å“ˆå¸Œè¡¨è¿…é€Ÿæ‰¾åˆ°ä»¥ A çš„åä¹‰å­˜å‚¨çš„æ•°æ®**ã€‚è¯¥ç®—æ³•çš„å…³é”®åœ¨äºè¿™é‡Œçš„ A å¿…é¡»æ˜¯å¯å“ˆå¸Œçš„ï¼Œå¯ä»¥ç®€å•åœ°ç†è§£ä¸º A æ˜¯ä¸å¯å˜çš„ã€‚

è€Œæ‰€è°“çš„å“ˆå¸Œè¡¨å…¶å®å°±æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œå“ˆå¸Œç®—æ³•é€šè¿‡å“ˆå¸Œå‡½æ•°ï¼ˆä¸€ç§æ˜ å°„ï¼‰ï¼Œå°†ã€Œä¸å¯å˜çš„æ•°æ®ã€æ˜ å°„ä¸ºã€Œä¸€ä¸ªæ•°å­—ï¼ˆç§°ä¸ºå“ˆå¸Œç ï¼‰ã€ä½œä¸ºå“ˆå¸Œè¡¨æ•°ç»„çš„ä¸‹æ ‡ï¼Œè¿›è€Œå­˜å‚¨åˆ°å“ˆå¸Œè¡¨ä¸­ã€‚ç”±äºæ•°ç»„æ˜¯å†…å­˜è¿ç»­çš„ï¼Œå› æ­¤ä¸€æ—¦çŸ¥é“å“ˆå¸Œç ï¼Œå°±å¯ä»¥ $O(1)$ åœ°åœ¨å“ˆå¸Œè¡¨æ•°ç»„ä¸­ç´¢å¼•å‡ºå­˜å‚¨çš„å†…å®¹ã€‚æ˜¯ä¸€ç§å…¸å‹çš„ç©ºé—´æ¢æ—¶é—´çš„æ¦‚å¿µã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨éœ€è¦æŸ¥è¯¢å‡ºä½ è¿™å­¦æœŸç¿˜äº†å‡ æ¬¡è¯¾ã€‚ä¸€ä¸ªæœ€ç›´è§‚çš„åšæ³•å°±æ˜¯éå†æ•°æ®åº“ç„¶ååŒ¹é…ä½ çš„å­¦å·ï¼ˆå‡è®¾å­¦å·å”¯ä¸€ï¼‰ï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $O(1)$ã€‚ä½†å¦‚æœæå‰åˆ©ç”¨å“ˆå¸Œç®—æ³•å­˜å‚¨äº†æ¯ä¸€ä¸ªå­¦å·å¯¹åº”çš„ç¿˜è¯¾æ¬¡æ•°ï¼Œé‚£ä¹ˆåœ¨è¾“å…¥ä½ çš„å­¦å·åï¼Œå°±å¯ä»¥é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºä½ å­¦å·çš„å“ˆå¸Œç ï¼Œç„¶ååœ¨å“ˆå¸Œè¡¨æ•°ç»„ä¸­ç´¢å¼•å‡ºç¿˜è¯¾çš„æ¬¡æ•°å³å¯ï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $O(n)$ã€‚

å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½å®ç°äº†å“ˆå¸Œçš„åŠŸèƒ½ï¼Œåªè¦å¯¹è±¡æ˜¯å¯å“ˆå¸Œçš„ï¼Œå°±å¯ä»¥åˆ©ç”¨è¯¥ç®—æ³•å®Œæˆç©ºé—´æ¢æ—¶é—´çš„æ“ä½œã€‚ä¾‹å¦‚ C++ ä¸­çš„ `unordered_map` ç±»ã€Python ä¸­çš„ `dict` ç±»ã€Java ä¸­çš„ `HashMap` ç±»ç­‰ã€‚

### å“ˆå¸Œå†²çª

å¦‚æœä½ çœ‹æ‡‚äº†ä¸Šé¢çš„è¡¨è¿°ï¼Œä¸€å®šä¼šäº§ç”Ÿè¿™æ ·çš„ç–‘é—®ï¼šå“ˆå¸Œè¡¨æ˜¯å†…å­˜è¿ç»­çš„ï¼Œé‚£ä¹ˆå“ˆå¸Œå‡½æ•°çš„æ˜ å°„ä¸€å®šè¦è¢«çº¦æŸåœ¨æŸä¸ªèŒƒå›´å§ï¼Ÿå¹¶ä¸”è¿˜å¾—ä¸€ä¸€æ˜ å°„å§ï¼Ÿæ²¡é”™ï¼Œè¿™æ˜¯å“ˆå¸Œç®—æ³•æœ€éœ€è¦è§£å†³çš„éš¾é¢˜ï¼šå“ˆå¸Œå†²çªï¼Œå³ä¸åŒçš„å¯¹è±¡æœ‰å¯èƒ½è¢«æ˜ å°„ä¸ºåŒä¸€ä¸ªç»“æœã€‚æ¯”å¦‚ä½ æ˜¯ä¸€ä¸ªä»ä¸ç¿˜è¯¾çš„å¥½å­©å­ï¼Œä½†æ˜¯å°æ˜ç»å¸¸ç¿˜è¯¾ï¼Œç»“æœå“ˆå¸Œç®—æ³•æŠŠä½ å’Œå°æ˜å“ˆå¸Œæˆäº†åŒä¸€ä¸ªç»“æœï¼Œå¯¼è‡´ä½ çš„ç¿˜è¯¾æ¬¡æ•°æŸ¥å‡ºæ¥å’Œå°æ˜ä¸€æ ·ï¼Œé‚£è¿™ä¸å°±å‡ºé—®é¢˜äº†å˜›ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¦ä¹ˆä¼˜åŒ–å“ˆå¸Œå‡½æ•°ä»è€Œé™ä½å“ˆå¸Œå†²çªçš„æ¦‚ç‡ï¼Œè¦ä¹ˆä¿®æ”¹å“ˆå¸Œè¡¨çš„ä¸€ç»´æ•°ç»„ç»“æ„ï¼Œå½»åº•è§£å†³å“ˆå¸Œå†²çªã€‚æˆ‘ä»¬å…³æ³¨åè€…ï¼Œå¸¸è§çš„æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š

1. æ‹‰é“¾æ³• (Chaining)ã€‚æˆ‘ä»¬ä»ç„¶æ²¿ç”¨ä¸€ç»´æ•°ç»„ä½œä¸ºå“ˆå¸Œè¡¨ï¼Œåªä¸è¿‡å°†æ•°ç»„å…ƒç´ ä¿®æ”¹ä¸ºå•é“¾è¡¨ã€‚ä¸€æ—¦å‘ç”Ÿå“ˆå¸Œå†²çªæ˜ å°„åˆ°äº†åŒä¸€ä¸ªæ•°ç»„ä½ç½®ï¼Œå°±åœ¨å¯¹åº”ä½ç½®çš„å•é“¾è¡¨ä¸­å¾€åæ‹‰é“¾å³å¯ã€‚åç»­æŸ¥è¯¢åˆ°è¯¥ä½ç½®æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥åŒ¹é…ï¼Œéœ€è¦éå†è¯¥ä½ç½®çš„å•é“¾è¡¨é€ä¸ªè¿›è¡ŒåŒ¹é…ï¼›
2. å¼€æ”¾åœ°å€æ³• (Open Addressing)ã€‚è¯¥æ³•ä¿æŒåŸæ¥çš„ä¸€ç»´æ•°ç»„ç»“æ„ä¸å˜ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å°†äº§ç”Ÿå“ˆå¸Œå†²çªçš„å…ƒç´ å­˜å‚¨åˆ°å…¶ä»–è¿˜æ²¡æœ‰è¢«å ç”¨çš„ä½ç½®ã€‚è¿™ç§æ–¹æ³•åœ¨é¢‘ç¹äº§ç”Ÿå“ˆå¸Œå†²çªæ—¶æ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºæ‰¾å…¶ä»–ç©ºä½éœ€è¦è¿›è¡Œã€Œç©ºä½æ¢æµ‹ã€ã€‚å¸¸è§çš„ç©ºä½æ¢æµ‹æ–¹æ³•æœ‰ï¼šçº¿æ€§æ¢æµ‹ï¼ˆä»äº§ç”Ÿå†²çªçš„åœ°æ–¹å¼€å§‹æ²¿ç€æŸä¸ªæ–¹å‘æ¢æµ‹ç©ºä½ï¼‰ã€åŒé‡å“ˆå¸Œæ¢æµ‹ï¼ˆåˆ©ç”¨ç¬¬äºŒä¸ªå“ˆå¸Œå‡½æ•°æ¢æµ‹å…¶ä½™ç©ºä½ï¼‰ç­‰ã€‚åç»­æŸ¥è¯¢åˆ°è¯¥ä½ç½®æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥åŒ¹é…ï¼Œéœ€è¦æŒ‰ç…§ç©ºä½æ¢æµ‹çš„é€»è¾‘éå†å…¶ä»–å¯èƒ½çš„ä½ç½®é€ä¸ªåŒ¹é…ã€‚

### å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„

åœ¨ C++ çš„ `unordered_map` åº“ä¸­ï¼Œ`unordered_map` ä¸ `unordered_multimap` ç±»å‡ç»§æ‰¿è‡ª `_Hashtable` åŸºç±» [^hashtable-path]ï¼Œè¯¥åŸºç±»å®šä¹‰äº†å“ˆå¸Œè¡¨çš„å…·ä½“ç»“æ„ï¼š

[^hashtable-path]: "D:\software\Jetbrains\CLion\bin\mingw\lib\gcc\x86_64-w64-mingw32\13.1.0\include\c++\bits\hashtable.h"

> In terms of Standard containers the hashtable is like the aggregation of:
>
> - `std::forward_list<_Node> containing the elements`
> - `std::vector<std::forward_list<_Node>::iterator> representing the buckets`

å¯ä»¥çœ‹å‡ºï¼Œå…¶å®šä¹‰çš„å“ˆå¸Œè¡¨æ˜¯ä¸€ç»´åŠ¨æ€æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ æ˜¯å‰å‘é“¾è¡¨ï¼ˆå³å•é“¾è¡¨ï¼‰ã€‚ä¹Ÿæ­£å› å¦‚æ­¤ï¼Œå“ˆå¸Œè¡¨åœ¨ç®—æ³•ç«èµ›åœºæ™¯ä¸­å¾€å¾€æ˜¯ useless çš„ï¼Œå› ä¸ºå‡ºé¢˜äººå¾ˆå®¹æ˜“æ„é€ ä¸€äº›æ•°æ®ä½¿å¾—é»˜è®¤çš„å“ˆå¸Œå‡½æ•°é¢‘ç¹å‡ºç°å“ˆå¸Œå†²çªï¼Œæ­¤æ—¶æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š

1. è‡ªå·± [é‡æ–°å®šä¹‰å“ˆå¸Œå‡½æ•°](../templates.md#å“ˆå¸Œè¡¨)ï¼›
2. ä¸ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œä½¿ç”¨ [å¹³è¡¡æ ‘](./ds.md#å¹³è¡¡æ ‘)ã€‚

### ä¾‹ï¼šTorn Lucky Ticket

> ç»å…¸ä¹‹å¤„ï¼šç¼“å­˜æ€æƒ³
>
> éš¾åº¦ï¼šCF 1400
>
> OJï¼š[CF](https://codeforces.com/contest/1895/problem/C)

é¢˜æ„ï¼šç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $n\ (1\le n\le 2\times 10^5)$ çš„å­—ç¬¦ä¸²æ•°ç»„ $a$ï¼Œ$a_i$ çš„é•¿åº¦ä¸è¶…è¿‡ $5$ ä¸”ä»…ç”±æ•°å­—ç»„æˆã€‚é—®æœ‰å¤šå°‘å¯¹ $(i,j)$ å¯ä»¥ä½¿å¾—æ‹¼æ¥åçš„å­—ç¬¦ä¸² $a_i+a_j$ é•¿åº¦ä¸ºå¶æ•°ä¸”å·¦åŠéƒ¨åˆ†çš„æ•°å­—ä¹‹å’Œä¸å³åŠéƒ¨åˆ†çš„æ•°å­—ä¹‹å’Œç›¸ç­‰ã€‚

æ€è·¯ï¼š

- æ ¹æ®æ•°æ®é‡ï¼Œæˆ‘ä»¬è‚¯å®šä¸èƒ½ $O(n^2)$ æš´åŠ›æšä¸¾ï¼Œè€ƒè™‘ä¼˜åŒ–ï¼›
- å¯¹äºæ¯ä¸€ä¸ªå­—ç¬¦ä¸² $a_i$ï¼Œæˆ‘ä»¬åªå…³å¿ƒã€Œé•¿åº¦ä¸æ€»å’Œã€åŒæ—¶æ»¡è¶³çš„ $a_j$ï¼Œå› æ­¤æˆ‘ä»¬é¢„å…ˆå“ˆå¸Œå­˜å‚¨æ¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ä¸æ€»å’Œï¼Œåç»­åœ¨æšä¸¾æ—¶ç›´æ¥ $O(1)$ åœ°å–å‡ºè¿›è¡Œè®¡æ•°å³å¯ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$

=== "Python"

    ```python
    n = int(input().strip())
    a = list(map(str, input().strip().split()))
    
    # å“ˆå¸Œæ¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ä¸æ€»å’Œ
    f = [[0] * 46 for _ in range(6)]
    for s in a:
        f[len(s)][sum([int(c) for c in s])] += 1
    
    # é€ä¸ªæšä¸¾å¹¶è®¡æ•°
    ans = 0
    for s in a:
        m = len(s)
        pre = [0] * (m + 1)
        for i in range(1, m + 1):
            pre[i] = pre[i - 1] + int(s[i - 1])
        
        # å½“å‰ä¸ºå³åŠéƒ¨åˆ†
        for i in range(m):
            now_len, now_sum = m - i, pre[m] - pre[i]
            tgt_len, tgt_sum = now_len - i, now_sum - pre[i]
            if tgt_len >= 0 and tgt_sum >= 0:
                ans += f[tgt_len][tgt_sum]
    
        # å½“å‰ä¸ºå·¦åŠéƒ¨åˆ†
        for i in range(m - 1, 0, -1):
            now_len, now_sum = i, pre[i]
            tgt_len, tgt_sum = now_len - (m - i), now_sum - (pre[m] - pre[i])
            if tgt_len >= 0 and tgt_sum >= 0:
                ans += f[tgt_len][tgt_sum]
    
    print(ans)
    ```

=== "C++"

    ```c++
    #include <iostream>
    #include <vector>
    using namespace std;
    
    int main() {
        int n;
        cin >> n;
    
        vector<string> a(n);
        vector<vector<int>> f(6, vector<int>(46, 0));
        for (int i = 0; i < n; i++) {
            cin >> a[i];
            int s = 0;
            for (char c: a[i]) {
                s += c - '0';
            }
            f[a[i].size()][s]++;
        }
    
        long long ans = 0;
        for (string s: a) {
            int m = s.size();
            vector<int> pre(m + 1, 0);
            for (int i = 1; i <= m; i++) {
                pre[i] = pre[i - 1] + s[i - 1] - '0';
            }
    
            // å½“å‰ä½œä¸ºå³åŠéƒ¨åˆ†
            for (int i = 0; i < m; i++) {
                int now_len = m - i, now_sum = pre[m] - pre[i];
                int tgt_len = now_len - i, tgt_sum = now_sum - pre[i];
                if (tgt_len >= 0 && tgt_sum >= 0) {
                    ans += f[tgt_len][tgt_sum];
                }
            }
    
            // å½“å‰ä½œä¸ºå·¦åŠéƒ¨åˆ†
            for (int i = m - 1; i > 0; i--) {
                int now_len = i, now_sum = pre[i];
                int tgt_len = now_len - (m - i), tgt_sum = now_sum - (pre[m] - pre[i]);
                if (tgt_len >= 0 && tgt_sum >= 0) {
                    ans += f[tgt_len][tgt_sum];
                }
            }
        }
    
        cout << ans << "\n";
    
        return 0;
    }
    ```

åŒç±»é¢˜æ¨èï¼š

- [æ´›è°· æ©™ | æ´›è°· | Cities and States S - (www.luogu.com.cn)](https://www.luogu.com.cn/problem/P3405)
- [æ´›è°· é»„ | æ´›è°· | æµ·æ¸¯ - (www.luogu.com.cn)](https://www.luogu.com.cn/problem/P2058)

## å¹¿ä¹‰è¡¨

å¹¿ä¹‰è¡¨å¯ä»¥çœ‹ä½œå•é“¾è¡¨çš„æ‰©å±•ç‰ˆï¼Œå…·å¤‡é€’å½’ç»“æ„ã€‚å…¶ç»“ç‚¹éœ€è¦å­˜å‚¨ä¸‰ç±»æ•°æ®ï¼š

![å¹¿ä¹‰è¡¨ç»“ç‚¹ç»“æ„ç¤ºæ„å›¾](https://cdn.dwj601.cn/images/202406292218530.png)

å…·ä½“åœ°ï¼š

1. `type`ï¼šå­˜å‚¨å½“å‰ç»“ç‚¹çš„ç±»å‹ï¼Œè¦ä¹ˆæ˜¯ç»“ç‚¹ï¼Œè¦ä¹ˆæ˜¯å­é“¾è¡¨ã€‚ä»¥æšä¸¾ç±»å‹ `enum` å­˜åœ¨ï¼Œèµ·æ ‡è¯†ä½œç”¨ï¼›

2. `data/sublist`ï¼šå­˜å‚¨å½“å‰ç»“ç‚¹çš„å†…å®¹ã€‚å¦‚æœæ˜¯ data ç±»å‹å°±å­˜å‚¨æ•°æ®ï¼›å¦‚æœæ˜¯ sublist ç±»å‹å°±å­˜å‚¨å­é“¾è¡¨çš„åœ°å€ã€‚ä»¥è”åˆä½“ç±»å‹ `union` å­˜åœ¨ï¼›
3. `next`ï¼šå­˜å‚¨ä¸‹ä¸€ä¸ªç»“ç‚¹çš„åœ°å€ã€‚ä»¥æŒ‡é’ˆå½¢å¼å­˜åœ¨ã€‚

å¹¿ä¹‰è¡¨ç»“ç‚¹å®šä¹‰çš„ C++ ä»£ç ï¼š

```c++
enum GListNodeType {
    ATOM, LIST
};
template<class T>
struct GListNode {
    GListNodeType type;
    union {
        T data;
        GListNode* sublist;
    };
    GListNode<T>* next;
};
```

å¹¿ä¹‰è¡¨çš„ç»“æ„ç¤ºæ„å›¾ï¼š

<img src="https://cdn.dwj601.cn/images/202406292218531.png" alt="å¹¿ä¹‰è¡¨çš„ç»“æ„ç¤ºæ„å›¾" style="zoom:67%;" />

### ä¾‹ï¼šå¤–æ˜Ÿå¯†ç 

> ç»å…¸ä¹‹å¤„ï¼šå¾ˆå°‘è§çš„å¯ä»¥ç”¨å¹¿ä¹‰è¡¨æ€è·¯å®Œæˆçš„é¢˜
>
> éš¾åº¦ï¼šæ´›è°· é»„
>
> OJï¼š[æ´›è°·](https://www.luogu.com.cn/problem/P1928)

é¢˜æ„ï¼šç»™å®šä¸€ä¸ªå‹ç¼©åçš„å¯†ç ä¸²ï¼Œéœ€è¦è§£å‹ä¸ºåŸæ¥çš„å½¢å¼ï¼ˆä¿è¯ä¸è¶…è¿‡ $20000$ ä¸”æœ€å¤š $10$ å±‚å‹ç¼©ï¼‰ã€‚ä¾‹å¦‚ï¼š

1. `AC[3FUN]` $\to$ `ACFUNFUNFUN`ï¼›
2. `AB[2[2GH]]OP[2PQ]CD` $\to$ `ABGHGHGHGHOPPQPQCD`ã€‚

æ€è·¯ï¼š

- å‹ç¼©å¯†ç ä¸²çš„ç»“æ„å¾ˆåƒå¹¿ä¹‰è¡¨ï¼Œå³å­˜åœ¨ä¸²è¡Œçš„çºµå‘é€’å½’ç»“æ„ï¼Œæ¯”å¦‚ä¸Šè¿°ç¬¬äºŒä¸ªæ ·ä¾‹ä¸­ `[2[2GH]]` ä¸ `[2PQ]` å°±æ˜¯ä¸²è¡Œçš„é€’å½’ç»“æ„ï¼›
- å¯¹äºæ­¤ç±»æ•°æ®ç»“æ„ï¼Œä¸€å®šä¸èƒ½å¿˜è®°å¤„ç†åç»­ä¸²è¡Œçš„é€’å½’ç»“æ„ï¼Œä»¥åŠéœ€è¦æ³¨æ„ç´¢å¼•å˜é‡çš„å¼•ç”¨é—®é¢˜ã€‚ç”±äº Python æ²¡æœ‰å¯¹å•ä¸€æ•´æ•°çš„å¼•ç”¨è¯­æ³•ï¼Œå› æ­¤ä½¿ç”¨å…¨å±€å˜é‡ä»£æ›¿ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$

=== "Python"

    ```python
    s = input().strip()
    i = 0
    
    def dfs() -> str:
        global i
        now = ""
    
        # é€’å½’ç»ˆç‚¹
        if i >= len(s):
            return now
    
        # å¤„ç†å‰ç¼€
        while i < len(s) and s[i].isalpha():
            now += s[i]
            i += 1
    
        # é€’å½’å¤„ç†
        if i < len(s) and s[i] == '[':
            i += 1
            x = 0
            while i < len(s) and s[i].isdigit():
                x = x * 10 + int(s[i])
                i += 1
            now += x * dfs()
        if i < len(s) and s[i] == ']':
            i += 1
            return now
    
        # å¤„ç†åç¼€
        now += dfs()
    
        return now
    
    print(dfs())
    ```

=== "C++"

    ```c++
    #include <iostream>
    
    using namespace std;
    
    string s;
    
    string dfs(int& i) {
        int n = s.size();
        string now = "";
    
        // é€’å½’ç»ˆç‚¹
        if (i >= n) {
            return now;
        }
        
        // å¤„ç†å‰ç¼€
        while (i < n and isalpha(s[i])) {
            now += s[i++];
        }
    
        // é€’å½’å¤„ç†
        if (i < n && s[i] == '[') {
            i++;
            int x = 0;
            while (i < n && isdigit(s[i])) {
                x = x * 10 + (s[i++] - '0');
            }
            string t = dfs(i);
            while (x--) {
                now += t;
            }
        }
        if (i < n && s[i] == ']') {
            i++;
            return now;
        }
    
        // å¤„ç†å°¾ä¸²
        now += dfs(i);
    
        return now;
    }
    
    int main() {
        cin >> s;
        int i = 0;
        cout << dfs(i) << "\n";
    
        return 0;    
    }
    ```

## æ ‘

æ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„ [å›¾](./graph.md) ç»“æ„ï¼Œå³æ— ç¯å›¾ã€‚å¤šæ£µæ ‘ï¼ˆä¸è¿é€šï¼‰å°±ç»„æˆäº†ä¸€ä¸ªæ£®æ—ã€‚å¦‚æœè¾¹æœ‰æ–¹å‘ï¼Œåˆ™è¿™ç±»æ ‘å…¶å®æ˜¯æœ‰å‘æ— ç¯å›¾ï¼›å¦‚æœè¾¹æ²¡æœ‰æ–¹å‘ï¼Œåˆ™è¿™ç±»æ ‘å…¶å®æ˜¯æ— å‘æ— ç¯å›¾ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é»˜è®¤éƒ½æ˜¯æœ‰å‘æ ‘ï¼Œæ¯”å¦‚æ ¹æ ‘ï¼Œè¡¨ç¤ºä»æ ¹ç»“ç‚¹å¼€å§‹é€å±‚æŒ‡å‘å­©å­ç»“ç‚¹ã€‚

å¯¹äºä¸€æ£µæœ‰å‘ $x$ å‰æ ‘ï¼Œæˆ‘ä»¬ç§°æ ‘ä¸­æ¯ä¸€ä¸ªç»“ç‚¹çš„å­ç»“ç‚¹æ•°é‡ä¸ºè¯¥ç»“ç‚¹çš„å‡ºåº¦ï¼Œ$x$ å³æ ‘ä¸­ç»“ç‚¹å‡ºåº¦çš„æœ€å¤§å€¼ã€‚

æ ¹æ ‘æœ‰ä¸¤ç§ç»“ç‚¹ï¼Œä¸€ç§ä¸ºåˆ†æ”¯ç»“ç‚¹ï¼Œä¸€ç§ä¸ºå¶å­ç»“ç‚¹ã€‚å…¶ä¸­ï¼Œåˆ†æ”¯ç»“ç‚¹è¡¨ç¤ºè¯¥ç»“ç‚¹å­˜åœ¨å­©å­ç»“ç‚¹ï¼Œè€Œå¶å­ç»“ç‚¹è¡¨ç¤ºè¯¥ç»“ç‚¹ä¸å­˜åœ¨å­©å­ç»“ç‚¹äº†ï¼Œå…¶å­©å­åŸŸä¸ºç©ºã€‚

### æ ‘çš„åŸºç¡€

**æ ‘çš„å­˜å‚¨**ã€‚ä¸å¹¿ä¹‰è¡¨ç±»å‹ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥ç”¨é“¾è¡¨æ¥å­˜å‚¨æ ‘ã€‚ä¸‹é¢ä»‹ç»ä¸¤ç§è¾ƒä¸ºå¸¸è§çš„æ ‘çš„å­˜å‚¨æ–¹å¼ï¼š

1. å¤šå‰é“¾è¡¨è¡¨ç¤ºæ³•ï¼šå³æ¯ä¸€ä¸ªç»“ç‚¹å­˜å‚¨æ‰€æœ‰å­©å­ç»“ç‚¹çš„æŒ‡é’ˆï¼Œå¯ä»¥ç”¨é™æ€æ•°ç»„å­˜å‚¨ï¼Œä½†æ˜¯è¿™éœ€è¦å°†æ•°ç»„ç©ºé—´å¼€åˆ°ç»“ç‚¹çš„æœ€å¤§åº¦æ•°ï¼Œæœ‰äº›æµªè´¹ç©ºé—´ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åŠ¨æ€æ•°ç»„æ¥å­˜å‚¨ï¼›
2. å­©å­å…„å¼Ÿè¡¨ç¤ºæ³•ï¼šå³æ¯ä¸€ä¸ªç»“ç‚¹åªå­˜å‚¨ä¸¤ä¸ªæŒ‡é’ˆï¼Œå…¶ä¸­å·¦æŒ‡é’ˆæŒ‡å‘å½“å‰ç»“ç‚¹çš„å­©å­ç»“ç‚¹ï¼Œå³æŒ‡é’ˆæŒ‡å‘å½“å‰ç»“ç‚¹çš„å…„å¼Ÿç»“ç‚¹ã€‚

ä¸Šè¿°æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨æ•°ç»„è¿›è¡Œæ¨¡æ‹Ÿã€‚å°¤å…¶æ˜¯ä½¿ç”¨åŠ¨æ€æ•°ç»„çš„å¤šå‰è¡¨ç¤ºæ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿæ˜¯ç®—æ³•ç«èµ›ä¸­æ¯”è¾ƒå¸¸è§ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿çš„å†™æ³•ï¼Œåæ–‡é»˜è®¤ä½¿ç”¨è¯¥æ–¹æ³•å­˜å‚¨æ ‘ã€‚

**äºŒå‰æ ‘**ã€‚å³æ ‘ä¸­çš„æ¯ä¸€ä¸ªç»“ç‚¹æœ€å¤šåªæœ‰ä¸¤ä¸ªå­©å­ç»“ç‚¹ã€‚ä»‹ç»ä¸¤ç§äºŒå‰æ ‘çš„æ„é€ æ–¹æ³•ï¼š

- ç”¨ä¸€ä¸ªå«æœ‰ç©ºæŒ‡é’ˆæ ‡è®°çš„éå†åºåˆ—æ„é€ äºŒå‰æ ‘ã€‚æœ‰å¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š

    1. éå†åºåˆ—ä¸ºå…ˆåºåºåˆ—ï¼šæŒ‰ç…§éå†çš„æ€è·¯æ¥ï¼Œå¯¹äºå…ˆåºåºåˆ—è€Œè¨€ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸€å®šæ˜¯æ ¹å…ƒç´ ï¼Œå› æ­¤é¦–å…ˆæ ¹æ®â€œå½“å‰å±€é¢â€çš„ç¬¬ä¸€ä¸ªå…ƒç´ åˆ›å»ºæ ¹ç»“ç‚¹ï¼Œæ¥ç€é€’å½’åˆ›å»ºå·¦å­æ ‘å’Œå³å­æ ‘å³å¯ï¼Œé€’å½’ç»ˆç‚¹å°±æ˜¯ç©ºæŒ‡é’ˆæ ‡è®°ï¼›
    2. éå†åºåˆ—ä¸ºä¸­åºåºåˆ—ï¼šä¸å¯ä»¥ï¼Œå› ä¸ºä¸èƒ½ç¡®å®šæ ¹èŠ‚ç‚¹ä»¥åŠå·¦å­æ ‘å’Œå³å­æ ‘çš„éƒ¨åˆ†ï¼›
    3. éå†åºåˆ—ä¸ºååºåºåˆ—ï¼šä¸ä¸Šè¿°å…ˆåºåºåˆ—è¿›è¡Œæ„å»ºçš„é€»è¾‘ç±»ä¼¼ï¼Œæˆ‘ä»¬ä»ååºåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ å¼€å§‹æ„å»ºï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯æ ¹ç»“ç‚¹ï¼Œç„¶åå†åˆ†åˆ«é€’å½’æ„å»ºå³å­æ ‘å’Œå·¦å­æ ‘ï¼Œé€’å½’ç»ˆç‚¹åŒæ ·ä¹Ÿæ˜¯ç©ºæŒ‡é’ˆæ ‡è®°ã€‚

- ç”¨ä¸¤ä¸ªä¸å«ç©ºæŒ‡é’ˆæ ‡è®°çš„éå†åºåˆ—æ„é€ äºŒå‰æ ‘ã€‚æœ‰å¦‚ä¸‹ä¸¤ç§æƒ…å†µï¼š

    1. å…ˆåºåºåˆ— + ä¸­åºåºåˆ—ï¼šç°åœ¨æˆ‘ä»¬æ²¡æœ‰ç©ºæŒ‡é’ˆæ ‡è®°äº†ï¼Œé‚£ä¹ˆå¦‚ä½•ç¡®å®šé€’å½’ç»ˆç‚¹å‘¢ï¼Ÿå¯ä»¥æ ¹æ®å…ˆåºåºåˆ—çš„é¦–ä¸ªå…ƒç´ åœ¨ä¸­åºåºåˆ—æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ç»“æœçš„å·¦åŠéƒ¨åˆ†å°±æ˜¯å·¦å­æ ‘ï¼Œå³åŠéƒ¨åˆ†å°±æ˜¯å³å­æ ‘ï¼ŒåŸºäºæ­¤è¿›è¡Œæ„é€ å³å¯ï¼›
    2. ååºåºåˆ— + ä¸­åºåºåˆ—ï¼šä¸ä¸Šè¿°ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚

å‡è®¾æ ‘ä¸­ç»“ç‚¹ä» $0$ å¼€å§‹ï¼Œé‚£ä¹ˆ $i$ å·ç‚¹çˆ¶ç»“ç‚¹å°±æ˜¯ $\lfloor (i-1)/2\rfloor$ï¼Œå·¦å­©å­å°±æ˜¯ $2i+1$ï¼Œå³å­©å­å°±æ˜¯ $2i+2$ï¼Œåˆ©ç”¨è¿™ç§æ€§è´¨ï¼ŒäºŒå‰æ ‘å¯ä»¥ç”¨çº¿æ€§è¡¨å­˜å‚¨ã€‚

**æ»¡äºŒå‰æ ‘ & å®Œå…¨äºŒå‰æ ‘**ã€‚æ»¡äºŒå‰æ ‘å°±æ˜¯æ ‘çš„æ¯ä¸€å±‚éƒ½æ˜¯æ»¡çš„ï¼Œå‡è®¾æ ¹ç»“ç‚¹ä¸ºç¬¬ $0$ å±‚ï¼Œåˆ™æ»¡äºŒå‰æ ‘çš„ç¬¬ $i$ å±‚å°±æ‹¥æœ‰ $2^i$ ä¸ªç»“ç‚¹ã€‚è€Œå®Œå…¨äºŒå‰æ ‘å°±æ˜¯æ»¡äºŒå‰æ ‘çš„æœ€åä¸€å±‚ä»æœ€å³è¾¹å¼€å§‹ç¼ºå°‘å‡ ä¸ªç»“ç‚¹ã€‚

**çº¿ç´¢äºŒå‰æ ‘**ã€‚äºŒå‰æ ‘çš„æ‰©å±•ç‰ˆï¼Œå°†äºŒå‰æ ‘ä¸­æ‰€æœ‰ç»“ç‚¹çš„ç©ºæŒ‡é’ˆæŒ‡å‘å…¶å‰é©±æˆ–åç»§ç»“ç‚¹ã€‚

**å“ˆå¤«æ›¼æ ‘**ã€‚ä¸€ç§åˆ©ç”¨è´ªå¿ƒç®—æ³•è®¾è®¡å‡ºæ¥çš„å­—ç¬¦ 01 ç¼–ç æ–¹å¼ï¼Œå¯ä»¥è¾¾åˆ°æœ€ä½³çš„ç¼–ç å‹ç¼©æ•ˆæœï¼Œä»è€Œæå‡æ•°æ®åœ¨ä¿¡é“ä¸­çš„ä¼ è¾“æ•ˆç‡ã€‚æˆ‘ä»¬å®šä¹‰ä¸€æ£µæ ‘çš„å¸¦æƒè·¯å¾„é•¿åº¦ (Weighted Path Length, WPL) ä¸ºæ‰€æœ‰å¶å­ç»“ç‚¹ã€Œè·¯å¾„é•¿åº¦ $\times$ æƒé‡ã€ä¹‹å’Œã€‚WPL æœ€å°çš„æ ‘å°±å«åšå“ˆå¤«æ›¼æ ‘ã€‚ä¸ºäº†å¾—åˆ°è¿™æ ·çš„ä¸€æ£µæ ‘ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹æ“ä½œï¼šæ¯æ¬¡é€‰æ‹©æƒå€¼æœ€å°çš„ä¸¤ä¸ªç»“ç‚¹è¿›è¡Œåˆå¹¶ï¼Œå¾—åˆ°ä¸€ä¸ªåˆ†æ”¯ç»“ç‚¹ï¼Œåˆå¹¶ $n-1$ æ¬¡ä¹‹åå¾—åˆ°çš„äºŒå‰æ ‘å°±æ˜¯å“ˆå¤«æ›¼æ ‘ã€‚åŸºäºè¿™æ£µå“ˆå¤«æ›¼æ ‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥å±•å¼€ä¿¡æ¯çš„ç¼–ç ä¸è§£ç å·¥ä½œã€‚

### æ ‘çš„éå†

å¯ä»¥ä½¿ç”¨ DFS æˆ–è€… BFS çš„æ–¹å¼è¿›è¡Œã€‚ä»¥å¤šå‰æœ‰å‘æ ‘ä¸ºä¾‹ï¼Œå‡è®¾æ ‘ä¸­æ¯ä¸ªç»“ç‚¹éƒ½ç”¨ä¸€ä¸ªæ•°å­— ID æ¥å”¯ä¸€è¡¨ç¤ºï¼Œé‚£ä¹ˆå°±æœ‰ä»¥ä¸‹éå†ä¼ªä»£ç ï¼š

=== "C++ DFS"

    ```c++
    vector<int> g[N];
    
    void dfs(int idx) {
        // do something
        for (auto& ch: g[idx]) {
            dfs(ch)
        }
    }
    
    dfs(0)
    ```

=== "C++ BFS"

    ```c++
    vector<int> g[N];
    
    void bfs(int idx) {
        // do something
    
        queue<int> q;
        q.push(idx);
    
        while (q.size()) {
            auto now = q.front();
            q.pop();
    
            // do something
    
            for (auto& ch: g[idx]) {
                q.push(ch);
            }
        }
    }
    
    bfs(0)
    ```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯æ— å‘æ ‘ï¼Œé‚£ä¹ˆéå†çš„æ—¶å€™è¦æ³¨æ„ä¸èƒ½å›è¿‡å¤´åˆéå†åˆ°è‡ªå·±çš„çˆ¶ç»“ç‚¹äº†ã€‚ä¸ºäº†è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š

- æ–°å¼€ä¸€ä¸ªå…ƒç´ å€¼ä¸º `bool` çš„ vis æ•°ç»„ç”¨æ¥æ ‡è®°æ¯ä¸€ä¸ªç»“ç‚¹æ˜¯å¦è¢«éå†è¿‡ï¼›
- DFS æ—¶å¤šä¼ ä¸€ä¸ªçˆ¶ç»“ç‚¹ ID å‚æ•°ï¼ŒBFS æ—¶å¤šä¿å­˜ä¸€ä¸ªçˆ¶ç»“ç‚¹ï¼Œè®©å­ç»“ç‚¹çŸ¥é“å…¶çˆ¶ç»“ç‚¹æ˜¯è°ä»è€Œä¸è¦éå†çˆ¶ç»“ç‚¹ã€‚

### æ ‘çš„é‡å¿ƒ

æ ‘çš„é‡å¿ƒå®šä¹‰ï¼šç»™å®šä¸€æ£µå«æœ‰ $n$ ä¸ªç»“ç‚¹çš„æ— å‘æ ‘ï¼Œæ‰¾åˆ°æ ‘ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œä½¿å¾—åˆ é™¤è¯¥ç»“ç‚¹åï¼Œå‰©ä½™å­æ ‘ä¸­ç»“ç‚¹æ•°é‡çš„æœ€å¤§å€¼æœ€å°ã€‚æ ‘çš„é‡å¿ƒå°±å®šä¹‰ä¸ºè¿™ä¸ªç»“ç‚¹ã€‚

è¿™é‡Œä¸åŠ è¯æ˜çš„ç»™å‡ºæ ‘çš„é‡å¿ƒçš„ä¸€äº›æ€§è´¨ [^property-tree-center]ï¼š

1. æ ‘çš„é‡å¿ƒå¦‚æœä¸å”¯ä¸€ï¼Œåˆ™è‡³å¤šæœ‰ä¸¤ä¸ªï¼Œä¸”è¿™ä¸¤ä¸ªé‡å¿ƒç›¸é‚»ï¼›
2. æŠŠä¸¤æ£µæ ‘é€šè¿‡ä¸€æ¡è¾¹ç›¸è¿å¾—åˆ°ä¸€æ£µæ–°æ ‘ï¼Œé‚£ä¹ˆæ–°æ ‘çš„é‡å¿ƒåœ¨è¿æ¥åŸæ¥ä¸¤æ£µæ ‘çš„é‡å¿ƒçš„è·¯å¾„ä¸Šã€‚

[^property-tree-center]: [æ ‘çš„é‡å¿ƒçš„æ€§è´¨ | OI Wiki - (oi-wiki.org)](https://oi-wiki.org/graph/tree-centroid/#æ€§è´¨)

æ˜¾ç„¶å¯ä»¥æ¯æšä¸¾ä¸€ä¸ªç»“ç‚¹å°±éå†ä¸€æ•´æ£µæ ‘ï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(n^2)$ çš„ï¼Œèƒ½å¦ä¼˜åŒ–ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬é‡‡ç”¨åˆ†æ²»ç­–ç•¥ã€‚å…·ä½“åœ°ï¼Œæˆ‘ä»¬è®¾è®¡è¿™æ ·ä¸€ä¸ªé€’å½’å‡½æ•° `dfs(idx)`ï¼Œå…¶è¿”å›ä»¥ `idx` ä¸ºæ ¹ç»“ç‚¹çš„å­æ ‘å¤§å°ï¼Œç„¶ååœ¨åˆ†æ²»é€’å½’çš„è¿‡ç¨‹ä¸­æ‰¾åˆ°ä½¿å¾—æœ€å¤§å­æ ‘æœ€å°çš„ç»“ç‚¹å³å¯ã€‚è¿™æ ·æ¯ä¸ªç»“ç‚¹åªéœ€è¦éå†ä¸¤éï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦æ˜¯ $O(n)$ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¯ä»¥è¯´è¿™æ˜¯ä¸€ç§å›æº¯æ³•çš„åº”ç”¨ã€‚ä»£ç ç¤ºä¾‹ï¼š

```python
n = int(input().strip())
g = [[] for _ in range(n + 1)]

for _ in range(n - 1):
    u, v = map(int, input().strip().split())
    g[u].append(v)
    g[v].append(u)

core = 1  # æ ‘çš„é‡å¿ƒ
min_max_size = n  # æœ€å°çš„æœ€å¤§å­æ ‘

def dfs(u: int, fa: int) -> int:
    """è¿”å›ç‚¹ u é™¤äº† fa æ–¹å‘çš„æ‰€æœ‰å­æ ‘ä¸­ï¼Œç»“ç‚¹æ•°æœ€å¤šçš„å­æ ‘çš„ç»“ç‚¹æ•°"""
    global core, min_max_size

    all_size = 0  # æ‰€æœ‰å­æ ‘çš„å¤§å°ï¼ˆé™¤äº† fa æ–¹å‘çš„å­æ ‘ï¼‰
    max_size = 0  # æœ€å¤§å­æ ‘çš„å¤§å°ï¼ˆé™¤äº† fa æ–¹å‘çš„å­æ ‘ï¼‰

    for v in g[u]:
        if v == fa:
            continue
        v_size = dfs(v, u)
        all_size += v_size
        if v_size > max_size:
            core = v
            max_size = v_size

    # fa æ–¹å‘çš„å­æ ‘å¤§å°
    if n - all_size - 1 > max_size:
        core = u
        max_size = n - all_size - 1

    # æ›´æ–°ç­”æ¡ˆ
    min_max_size = min(min_max_size, max_size)

    return all_size + 1

dfs(1, -1)

print(f"æ ‘çš„é‡å¿ƒï¼š{core}")
print(f"æœ€å°çš„æœ€å¤§å­æ ‘ï¼š{min_max_size}")
```

å¯¹äºä¸‹é¢è¿™æ£µæ ‘ï¼š

![ç¤ºä¾‹æ ‘](https://cdn.dwj601.cn/images/20250613213451082.png)

ç¨‹åºè¾“å‡ºç»“æœä¸ºï¼š

```text
æ ‘çš„é‡å¿ƒï¼š4
æœ€å°çš„æœ€å¤§å­æ ‘ï¼š4
```

å½“ç„¶ï¼Œ$1$ å·ç‚¹å…¶å®ä¹Ÿæ˜¯æ ‘çš„é‡å¿ƒï¼Œè¿™ä¹ŸéªŒè¯äº†ä¸Šè¿°ç¬¬ä¸€æ¡æ€§è´¨ã€‚

### æ ‘çš„ç›´å¾„

æ ‘çš„ç›´å¾„å®šä¹‰ä¸ºï¼šæ ‘ä¸Šä»»æ„ä¸¤ç‚¹é—´çš„æœ€é•¿ç®€å•è·¯å¾„é•¿åº¦ã€‚è¿™é‡Œä¸åŠ è¯æ˜åœ°ç»™å‡ºä¸€äº›æ€§è´¨ [^diameter-property-1] [^diameter-property-2]ï¼š

1. æ ‘çš„å¤šæ¡ç›´å¾„å¿…ç›¸äº¤ï¼›
2. æ ‘çš„å¤šæ¡ç›´å¾„çš„äº¤ç‚¹å¿…ä¸ºæ‰€æœ‰ç›´å¾„çš„ä¸­ç‚¹ã€‚

[^diameter-property-1]: [æ ‘çš„ç›´å¾„ | Dangerise - (www.luogu.com.cn)](https://www.luogu.com.cn/article/zbu09jkr)
[^diameter-property-2]: [æ ‘çš„ç›´å¾„ï¼Œæ ‘çš„ä¸­å¿ƒæ€§è´¨æ•´ç† | dbxxx - (www.cnblogs.com)](https://www.cnblogs.com/crab-in-the-northeast/p/diameter-and-center-on-tree.html)

æ±‚è§£æ–¹æ³• [^0x3f-diameter] [^oiwiki-diameter] æœ‰ä¸¤ç§ï¼š

1. é€‰æ‹©ä»»æ„ä¸€ç‚¹ $x$ è¿›è¡Œ DFS/BFSï¼Œæ‰¾åˆ°ç¦»å…¶æœ€è¿œçš„ç‚¹ $u$ï¼Œåˆ™ $u$ å°±æ˜¯ç›´å¾„çš„ä¸€ä¸ªç«¯ç‚¹ï¼Œæ¥ç€ä»¥ $u$ ä¸ºèµ·ç‚¹å†è¿›è¡Œä¸€æ¬¡ DFS/BFS æ‰¾åˆ°ç¦»å…¶æœ€è¿œçš„ç‚¹ $v$ï¼Œåˆ™ $u,v$ å°±æ˜¯ç›´å¾„çš„ä¸¤ä¸ªç«¯ç‚¹ã€‚è¯¥æ–¹æ³•ä¸é€‚ç”¨äºè´Ÿæƒæ ‘ï¼›
2. éå†æ¯ä¸€ä¸ªç»“ç‚¹å¹¶è®¡ç®—ä»¥å½“å‰ç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¸­ï¼Œæœ€é•¿çš„ä¸¤æ¡å­é“¾é•¿åº¦ä¹‹å’Œï¼Œå–æœ€å¤§å€¼å³ä¸ºæ ‘çš„ç›´å¾„ã€‚å¯ä»¥åˆ©ç”¨å›æº¯æ³•åœ¨ $O(n)$ çš„æ—¶é—´å¤æ‚åº¦å†…è¿›è¡Œæ±‚è§£ã€‚è¯¥æ–¹æ³•åœ¨è´Ÿæƒæ ‘ä¸Šä¹Ÿé€‚ç”¨ã€‚

[^0x3f-diameter]:[æ ‘å½¢ DPï¼šæ ‘çš„ç›´å¾„ã€åŸºç¡€ç®—æ³•ç²¾è®² 23ã€‘ | çµèŒ¶å±±è‰¾åºœ - (www.bilibili.com)](https://www.bilibili.com/video/BV17o4y187h1/)
[^oiwiki-diameter]: [æ ‘çš„ç›´å¾„ | OI Wiki - (oi-wiki.org)](https://oi-wiki.org/graph/tree-diameter/)

ä»¥ [ä¸²é—¨ | è“æ¡¥ - (www.lanqiao.cn)](https://www.lanqiao.cn/problems/5890/learning/?contest_id=145) è¿™é“é¢˜ä¸ºä¾‹ï¼šç»™å®šä¸€æ£µæ— å‘æ ‘ï¼Œå…±æœ‰ $n\ (1\le n \le 10^5)$ ä¸ªç»“ç‚¹ï¼Œç»“ç‚¹ç¼–å·ä» $1$ å¼€å§‹ï¼Œè¾¹æƒä¸º $w\ (1\le w_i\le 10^9)$ã€‚ç»™å‡ºã€Œåœ¨è®¿é—®åˆ°æ ‘ä¸­æ¯ä¸€ä¸ªç»“ç‚¹ã€çš„æƒ…å†µä¸‹ï¼Œæœ€çŸ­è·¯å¾„é•¿åº¦ã€‚

æ˜¾ç„¶æˆ‘ä»¬å¯ä»¥æšä¸¾æ¯ä¸€ä¸ªç‚¹ä½œä¸ºèµ·ç‚¹éå†æ•´æ£µæ ‘å¾—åˆ°è·¯å¾„é•¿åº¦ï¼Œæœ€åå–æœ€å°å€¼å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(n^2)$ï¼Œè€ƒè™‘ä¼˜åŒ–ã€‚ä¸éš¾å‘ç°ï¼šå¯¹äºä¸€æ¬¡éå†ä¸‹è®¿é—®åˆ°çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œè·¯å¾„é•¿åº¦ä¸€å®šæ˜¯ `èµ·ç‚¹åˆ°ç»ˆç‚¹çš„ç®€å•è·¯å¾„é•¿åº¦ + æ‰€æœ‰åˆ†æ”¯è·¯å¾„é•¿åº¦çš„ä¸¤å€`ï¼Œè€Œè¿™æ°å¥½ç­‰äº `æ‰€æœ‰è¾¹ä¹‹å’Œçš„ä¸¤å€ - èµ·ç‚¹åˆ°ç»ˆç‚¹çš„ç®€å•è·¯å¾„é•¿åº¦`ã€‚äºæ˜¯é—®é¢˜å°±è½¬åŒ–ä¸ºäº†æ±‚è§£æ ‘çš„ç›´å¾„ã€‚ç”±äºæœ¬é¢˜æƒé‡ä¸ºæ­£ï¼Œæ•…ä¸¤æ¬¡éå†æˆ–è€…å›æº¯æ³•éƒ½å¯ä»¥è§£å†³ï¼Œä¸‹é¢ç»™å‡ºæ‰€æœ‰è§£æ³•ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$

=== "Python ä¸¤æ¬¡ BFS"

    ```python
    from collections import deque
    from typing import Tuple
    
    n = int(input().strip())
    g = [[] for _ in range(n + 1)]
    
    double_path_length = 0
    
    for _ in range(n - 1):
        u, v, w = map(int, input().strip().split())
        g[u].append((v, w))
        g[v].append((u, w))
        double_path_length += w << 1
    
    def bfs(u: int) -> Tuple[int, int]:
        """è¿”å›è·ç¦» u æœ€è¿œçš„ç‚¹ä»¥åŠå¯¹åº”çš„è·ç¦»"""
        q = deque()
        d = [0] * (n + 1)
        vis = [False] * (n + 1)
    
        q.append(u)
        d[u] = 0
        vis[u] = True
    
        while len(q):
            now = q.popleft()
            for ch, w in g[now]:
                if vis[ch]:
                    continue
                q.append(ch)
                d[ch] = d[now] + w
                vis[ch] = True
    
        max_d = max(d)
        return d.index(max_d), max_d
    
    x, _ = bfs(1)
    _, diameter = bfs(x)
    
    print(double_path_length - diameter)
    ```

=== "Python ä¸¤æ¬¡ DFS"

    ```python
    import sys
    sys.setrecursionlimit(10**5 + 1)
    
    n = int(input().strip())
    g = [[] for _ in range(n + 1)]
    
    double_path_length = 0
    
    for _ in range(n - 1):
        u, v, w = map(int, input().strip().split())
        g[u].append((v, w))
        g[v].append((u, w))
        double_path_length += w << 1
    
    diameter = 0
    v = 1  # ç›´å¾„çš„æŸä¸ªç«¯ç‚¹
    
    def dfs(u: int, dep: int, fa: int) -> None:
        """é€’å½’ï¼šå½“å‰ç»“ç‚¹ä¸º uï¼Œè·ç¦»æ ¹ç»“ç‚¹ä¸º depï¼Œçˆ¶ç»“ç‚¹ä¸º fa"""
        global diameter, v
        if dep > diameter:
            diameter = dep
            v = u
        for ch, w in g[u]:
            if ch != fa:
                dfs(ch, dep + w, u)
    
    dfs(v, 0, -1)
    dfs(v, 0, -1)
    
    print(double_path_length - diameter)
    ```

=== "Python å›æº¯æ³•"

    ```python
    import sys
    sys.setrecursionlimit(10**5 + 1)
    
    n = int(input().strip())
    g = [[] for _ in range(n + 1)]
    
    double_path_length = 0
    
    for _ in range(n - 1):
        u, v, w = map(int, input().strip().split())
        g[u].append((v, w))
        g[v].append((u, w))
        double_path_length += w << 1
    
    diameter = 0
    
    def dfs(u: int, fa: int) -> int:
        """è¿”å›ä»¥ u ä¸ºæ ¹ä¸”ä¸åŒ…æ‹¬ fa åˆ†æ”¯æ–¹å‘çš„å­æ ‘çš„æœ€å¤§æ·±åº¦"""
        global diameter
        u_dep = 0
        for v, w in g[u]:
            if v == fa:
                continue
            v_dep = dfs(v, u) + w
            diameter = max(diameter, u_dep + v_dep)
            u_dep = max(u_dep, v_dep)
        return u_dep
    
    dfs(1, -1)
    
    print(double_path_length - diameter)
    ```

### æœ€è¿‘å…¬å…±ç¥–å…ˆ

å¯¹äºä¸€æ£µæœ‰æ ¹æ ‘ï¼Œç»“ç‚¹ $u$ å’Œ $v$ çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ (Lowest Common Ancestor, LCA) å®šä¹‰ä¸º $u$ å’Œ $v$ çš„å…¬å…±ç¥–å…ˆä¸­ï¼Œè·ç¦»æ ¹ç»“ç‚¹æœ€è¿œçš„é‚£ä¸ªç»“ç‚¹ã€‚æˆ‘ä»¬è®° $\text{lca}(u,v)$ ä¸º $u,v$ ä¸¤ä¸ªç»“ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ä¸‹é¢ä»¥æ¨¡æ¿é¢˜ [æœ€è¿‘å…¬å…±ç¥–å…ˆ | æ´›è°· - (www.luogu.com.cn)](https://www.luogu.com.cn/problem/P3379) ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚

ä¸ºäº†æ±‚è§£ $\text{lca}(u,v)$ï¼Œæœ´ç´ åšæ³•å°±æ˜¯ä» $u$ å’Œ $v$ å¼€å§‹ä¸€æ­¥æ­¥å‘æ ¹ç»“ç‚¹è·³ï¼Œç›´åˆ°æ¢æµ‹åˆ°æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ä»£ç å®ç°ä¸Šï¼Œå¯ä»¥å…ˆä»æ ¹ç»“ç‚¹å¼€å§‹ DFS/BFS æ•´æ£µæ ‘ï¼Œç»´æŠ¤æ¯ä¸€ä¸ªç»“ç‚¹çš„çˆ¶ç»“ç‚¹åŠå…¶æ·±åº¦ã€‚åç»­æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆå°†æ·±åº¦å¤§çš„ç»“ç‚¹è·³åˆ°å’Œå¦ä¸€ä¸ªç»“ç‚¹ä¸€æ ·é«˜ï¼Œç„¶åä¸¤ä¸ªç»“ç‚¹ä¸€èµ·å¾€ä¸Šè·³å¹¶åˆ¤å®šæ˜¯å¦æ‰¾åˆ°äº†æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚å¯¹äºä¸€æ£µå«æœ‰ $n$ ä¸ªç»“ç‚¹çš„æœ‰æ ¹æ ‘ï¼Œæœ´ç´ æ³•æ¯æ¬¡æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ã€‚

è€ƒè™‘ä¼˜åŒ–ã€‚ä¸€ä¸ªç»“ç‚¹å¾€ä¸Šè·³çš„è¿‡ç¨‹å¯ä»¥ä½¿ç”¨å€å¢ç®—æ³•è¿›è¡Œä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œç»“ç‚¹å‘ä¸Šè·³ $k$ æ­¥ï¼Œå¯ä»¥æ‹†åˆ†ä¸ºå‘ä¸Šè·³ã€Œ$k$ çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ $1$ çš„ä¸ªæ•°ã€æ­¥ã€‚è¿™æ ·å°±å¯ä»¥å°†æ¯æ¬¡æŸ¥è¯¢æ—¶ $O(n)$ çš„è·³è·ƒå¤æ‚åº¦ä¼˜åŒ–åˆ° $O(\log n)$ã€‚ä»£ç ç¤ºä¾‹ï¼š

```python
def lca(u: int, v: int) -> int:
    """è¿”å› u å’Œ v çš„æœ€è¿‘å…¬å…±ç¥–å…ˆç»“ç‚¹ç¼–å·"""
    
    # ä¿è¯ u ä¸é«˜äº v
    if d[u] < d[v]:
        u, v = v, u
    
    # è®© u è·³åˆ°ä¸ v åŒä¸€ä¸ªæ·±åº¦
    for i in range(19, -1, -1):
        if d[f[u][i]] >= d[v]:
            u = f[u][i]
    
    # ç‰¹åˆ¤ï¼šuã€v å’Œ root åœ¨ä¸€æ¡é“¾ä¸Š
    if u == v:
        return u

    # u å’Œ v ä¸€èµ·å¾€ä¸Šè·³
    for i in range(19, -1, -1):
        if f[u][i] != f[v][i]:
            u, v = f[u][i], f[v][i]
    
    return f[u][0]
```

ä¸ºäº†è¾¾åˆ°ä¸Šè¿°å€å¢è·³è·ƒçš„ç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦é¢„å…ˆç»´æŠ¤å‡ºæ¯ä¸€ä¸ªç»“ç‚¹å‘ä¸Šè·³è·ƒ $2^i\ (0\le i\le \log n)$ æ­¥ä»¥ååˆ°è¾¾çš„ç»“ç‚¹ç¼–å·ã€‚è®° $f_{u,i}$ è¡¨ç¤º $u$ å·ç»“ç‚¹å‘ä¸Šè·³è·ƒ $2^i$ æ­¥ååˆ°è¾¾çš„ç»“ç‚¹ç¼–å·ï¼Œ$u$ å·ç»“ç‚¹çš„çˆ¶ç»“ç‚¹ç¼–å·ä¸º $fa$ï¼Œæ˜¾ç„¶æœ‰ $f_{u,0}=fa$ï¼Œåˆç”±äº $u$ å·ç»“ç‚¹å‘ä¸Šè·³è·ƒ $2^i$ æ­¥ç­‰ä»·äºå…ˆå‘ä¸Šè·³è·ƒ $2^{i-1}$ æ­¥ï¼Œå†å‘ä¸Šè·³è·ƒ $2^{i-1}$ æ­¥ï¼Œå³ $f_{u,i}=f_{f_{u,i-1},i-1}$ï¼Œå› æ­¤ $f$ æ•°ç»„å¯ä»¥ä½¿ç”¨é€’æ¨ç®—æ³•ç»´æŠ¤ã€‚æ¯ä¸ªç»“ç‚¹éœ€è¦ $O(\log n)$ ç»´æŠ¤ï¼Œé‚£ä¹ˆ $n$ ä¸ªç»“ç‚¹å°±è¦ $O(n\log n)$ ç»´æŠ¤ã€‚ä»£ç ç¤ºä¾‹ï¼š

```python
f[u][0] = fa
for i in range(1, 20):
    f[u][i] = f[f[u][i - 1]][i - 1]
```

æœ‰äº† $f$ æ•°ç»„ï¼Œæ±‚è§£ $\text{lca}(u,v)$ çš„æ€è·¯å°±å¯ä»¥ä»ç„¶æ²¿ç”¨æœ´ç´ ç®—æ³•ï¼Œåªä¸è¿‡åœ¨è·³è·ƒæ—¶å¯ä»¥åˆ©ç”¨å€å¢ç®—æ³•è¿›è¡Œä¼˜åŒ–äº†ã€‚å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š

=== "Python æœ´ç´  LCA"

    ```python
    import sys
    sys.setrecursionlimit(5 * 10**5 + 1)
    
    n, q, root = map(int, input().strip().split())
    g = [[] for _ in range(n + 1)]
    d = [0] * (n + 1)  # d[u] è¡¨ç¤º u å·ç‚¹åˆ°æ ¹ç»“ç‚¹çš„è·ç¦»ï¼Œæˆ–è€…ç†è§£ä¸ºæ·±åº¦
    f = [0] * (n + 1)  # f[u] è¡¨ç¤º u å·ç‚¹çš„çˆ¶ç»“ç‚¹
    
    def dfs(u: int, fa: int) -> None:
        """é€’å½’ï¼šå½“å‰ç»“ç‚¹ä¸º uï¼Œçˆ¶ç»“ç‚¹ä¸º fa"""
    
        # ç»´æŠ¤æ·±åº¦
        d[u] = d[fa] + 1
    
        # ç»´æŠ¤ç¥–å…ˆ
        f[u] = fa
    
        # é€’å½’
        for ch in g[u]:
            if ch != fa:
                dfs(ch, u)
    
    def lca(u: int, v: int) -> int:
        """è¿”å› u å’Œ v çš„æœ€è¿‘å…¬å…±ç¥–å…ˆç»“ç‚¹ç¼–å·"""
    
        # ä¿è¯ u ä¸é«˜äº v
        if d[u] < d[v]:
            u, v = v, u
    
        # è®© u è·³åˆ°ä¸ v åŒä¸€ä¸ªæ·±åº¦
        while d[u] > d[v]:
            u = f[u]
    
        # ç‰¹åˆ¤ï¼šuã€v å’Œ root åœ¨ä¸€æ¡é“¾ä¸Š
        if u == v:
            return u
    
        # u å’Œ v ä¸€èµ·å¾€ä¸Šè·³
        while f[u] != f[v]:
            u, v= f[u], f[v]
    
        return f[u]
    
    if __name__ == "__main__":
        # å»ºæ ‘
        for _ in range(n - 1):
            u, v = map(int, input().strip().split())
            g[u].append(v)
            g[v].append(u)
    
        # ç»´æŠ¤æ·±åº¦ & æœ´ç´ ç»´æŠ¤ç¥–å…ˆ
        d[0] = -1
        dfs(root, 0)
    
        # æ±‚è§£ LCA
        OUTs = []
        for _ in range(q):
            u, v = map(int, input().strip().split())
            OUTs.append(lca(u, v))
        print('\n'.join(map(str, OUTs)))
    ```

=== "Python å€å¢ LCA"

    ```python
    import sys
    sys.setrecursionlimit(5 * 10**5 + 1)
    
    n, q, root = map(int, input().strip().split())
    g = [[] for _ in range(n + 1)]
    d = [0] * (n + 1)  # d[u] è¡¨ç¤º u å·ç‚¹åˆ°æ ¹ç»“ç‚¹çš„è·ç¦»ï¼Œæˆ–è€…ç†è§£ä¸ºæ·±åº¦
    f = [[0] * 20 for _ in range(n + 1)]  # f[u][i] è¡¨ç¤º u å·ç‚¹å‘ä¸Šè·³è·ƒ 2^i æ­¥åå¯ä»¥åˆ°è¾¾çš„ç»“ç‚¹ç¼–å·
    
    def dfs(u: int, fa: int) -> None:
        """é€’å½’ï¼šå½“å‰ç»“ç‚¹ä¸º uï¼Œçˆ¶ç»“ç‚¹ä¸º fa"""
    
        # ç»´æŠ¤æ·±åº¦
        d[u] = d[fa] + 1
    
        # ç»´æŠ¤ç¥–å…ˆ
        f[u][0] = fa
        for i in range(1, 20):
            f[u][i] = f[f[u][i - 1]][i - 1]
    
        # é€’å½’
        for ch in g[u]:
            if ch != fa:
                dfs(ch, u)
    
    def lca(u: int, v: int) -> int:
        """è¿”å› u å’Œ v çš„æœ€è¿‘å…¬å…±ç¥–å…ˆç»“ç‚¹ç¼–å·"""
    
        # ä¿è¯ u ä¸é«˜äº v
        if d[u] < d[v]:
            u, v = v, u
    
        # è®© u è·³åˆ°ä¸ v åŒä¸€ä¸ªæ·±åº¦
        for i in range(19, -1, -1):
            if d[f[u][i]] >= d[v]:
                u = f[u][i]
    
        # ç‰¹åˆ¤ï¼šuã€v å’Œ root åœ¨ä¸€æ¡é“¾ä¸Š
        if u == v:
            return u
    
        # u å’Œ v ä¸€èµ·å¾€ä¸Šè·³
        for i in range(19, -1, -1):
            if f[u][i] != f[v][i]:
                u, v = f[u][i], f[v][i]
    
        return f[u][0]
    
    if __name__ == "__main__":
        # å»ºæ ‘
        for _ in range(n - 1):
            u, v = map(int, input().strip().split())
            g[u].append(v)
            g[v].append(u)
    
        # ç»´æŠ¤æ·±åº¦ & å€å¢ç»´æŠ¤ç¥–å…ˆ
        d[0] = -1
        dfs(root, 0)
    
        # æ±‚è§£ LCA
        OUTs = []
        for _ in range(q):
            u, v = map(int, input().strip().split())
            OUTs.append(lca(u, v))
        print('\n'.join(map(str, OUTs)))
    ```

### æ ‘çŠ¶æ•°ç»„

æ ‘çŠ¶æ•°ç»„çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨é¢å¤–çš„ç©ºé—´æ¥ç»´æŠ¤åºåˆ—çš„åŒºé—´å’Œï¼Œæ‰€æœ‰è¢«ç»´æŠ¤çš„åŒºé—´ä¿¡æ¯å°±ç»„æˆäº†ä¸€æ£µæ ‘ï¼Œæ•…è¯¥ç®—æ³•è¢«ç§°ä¸ºæ ‘çŠ¶æ•°ç»„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†ç¼–ç æ–¹ä¾¿ï¼Œè¯¥ç®—æ³•çš„åºåˆ— $a$ ä¸‹æ ‡ä» $1$ å¼€å§‹ã€‚æ ‘çŠ¶æ•°ç»„æ”¯æŒçš„æ“ä½œæœ‰ï¼š

- åŒºé—´æŸ¥è¯¢ï¼šç»™å®šä¸‹æ ‡ç´¢å¼• $i$ï¼Œè¾“å‡ºåºåˆ—è¢«ç´¢å¼•çš„åŒºé—´å’Œ $\sum_{i=1}^i a_i$ã€‚æ—¶é—´å¤æ‚åº¦ $O(\log n)$ï¼›
- å•ç‚¹ä¿®æ”¹ï¼šç»™å®šä¸‹æ ‡ç´¢å¼• $i$ï¼Œä¿®æ”¹åºåˆ—è¢«ç´¢å¼•çš„å…ƒç´ å€¼ $a_i$ã€‚æ—¶é—´å¤æ‚åº¦ $O(\log n)$ã€‚

### çº¿æ®µæ ‘

TODO

### å¹³è¡¡æ ‘

å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ $O(\log n)$ æ—¶é—´å¤æ‚åº¦å†…å¯¹æ•°æ®è¿›è¡Œå¢åˆ æŸ¥æ”¹çš„æ“ä½œï¼Œå°±å¯ä»¥å¼•å…¥ã€ŒäºŒå‰æœç´¢æ ‘ (Binary Search Tree)ã€è¿™ä¸€æ•°æ®ç»“æ„ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æç«¯çš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚å½“æ’å…¥çš„æ•°æ®æ˜¯å•è°ƒä¸å‡æˆ–ä¸å¢æ—¶ï¼Œè¿™æ£µæ ‘å°±ä¼šé€€åŒ–ä¸ºä¸€æ¡é“¾ä»è€Œå¯¼è‡´æ‰€æœ‰çš„å¢åˆ æŸ¥æ”¹æ“ä½œé€€åŒ–åˆ° $O(n)$ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸æ„¿æ„çœ‹åˆ°çš„ã€‚å› æ­¤æˆ‘ä»¬å¼•å…¥ã€Œå¹³è¡¡äºŒå‰æœç´¢æ ‘ (Balanced Binary Search Tree) ç®€ç§°å¹³è¡¡æ ‘ã€è¿™ä¸€æ•°æ®ç»“æ„ã€‚

å…³äºå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œæœ‰éå¸¸å¤šçš„å˜ç§ä¸å®ç°ï¼Œä¸åŒçš„åº”ç”¨åœºæ™¯ä¼šé€‰æ‹©ä¸åŒçš„å˜ç§ã€‚ä¾‹å¦‚ï¼š

- ã€ŒTreapã€æ›´çµæ´»ï¼Œé€šè¿‡éšæœºåŒ–ä¼˜å…ˆçº§å®ç°é¢„æœŸçš„å¹³è¡¡ï¼Œä½†åœ¨æœ€åæƒ…å†µä¸‹å¯èƒ½é€€åŒ–ï¼›
- ã€ŒAVL æ ‘ã€ä¸¥æ ¼ä¿æŒå¹³è¡¡ï¼Œä¿è¯äº† $O(\log n)$ çš„æ€§èƒ½ï¼Œä½†åœ¨é¢‘ç¹æ’å…¥å’Œåˆ é™¤çš„åœºæ™¯ä¸‹å¯èƒ½æœ‰è¾ƒå¤§çš„æ—‹è½¬å¼€é”€ï¼›
- ã€Œçº¢é»‘æ ‘ã€é€šè¿‡è¾ƒå®½æ¾çš„å¹³è¡¡æ¡ä»¶å®ç°äº†è¾ƒå¥½çš„æ’å…¥å’Œåˆ é™¤æ€§èƒ½ï¼Œé€šå¸¸è¢«å¹¿æ³›ç”¨äºéœ€è¦é«˜æ•ˆæ’å…¥åˆ é™¤æ“ä½œçš„ç³»ç»Ÿï¼ˆå¦‚ STL ä¸­çš„ `map` å’Œ `set`ï¼‰ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œçº¢é»‘æ ‘æ˜¯ä¸€ä¸ªè¾ƒä¸ºé€šç”¨çš„é€‰æ‹©ï¼Œè€Œåœ¨éœ€è¦ä¸¥æ ¼å¹³è¡¡æ€§æ—¶ï¼ŒAVL æ ‘å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚

**äºŒå‰æœç´¢æ ‘**ã€‚äºŒå‰æœç´¢æ ‘åˆå«äºŒå‰æ’åºæ ‘ã€äºŒå‰æŸ¥æ‰¾æ ‘ã€‚

- å®šä¹‰ï¼šæ ¹ç»“ç‚¹æ¯”å·¦å­æ ‘æ‰€æœ‰ç»“ç‚¹çš„å€¼éƒ½å¤§ï¼Œæ¯”å³å­æ ‘æ‰€æœ‰ç»“ç‚¹çš„å€¼éƒ½å°ã€‚å…³é”®å­—å”¯ä¸€ï¼›
- æ“ä½œï¼šå¢åŠ ã€ä¿®æ”¹ã€æŸ¥è¯¢ã€åˆ é™¤ï¼›
- åˆ¤å®šï¼šæƒ³è¦åˆ¤å®šä¸€æ£µäºŒå‰æ ‘æ˜¯å¦ä¸ºäºŒå‰æœç´¢æ ‘ï¼Œåªéœ€è¦åˆ¤æ–­ä¸­åºéå†çš„ç»“æœæ˜¯ä¸æ˜¯é€’å¢çš„å³å¯ï¼Œå¯ä»¥é‡‡å–ä¸­åºéå†åºåˆ—æ¯”å¯¹çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åœ¨é€’å½’éå†äºŒå‰æ ‘çš„è¿‡ç¨‹ä¸­é€šè¿‡è®°å½•å‰é©±ç»“ç‚¹çš„å€¼ç›´æ¥è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­ã€‚æ—¶é—´å¤æ‚åº¦ $O(n)$ã€‚

**å¹³è¡¡äºŒå‰æœç´¢æ ‘**ã€‚C++ ä¸­å«åš `std::map`ï¼ŒPython ä¸­å«åš `from sortedcontainers import SortedList`ã€‚

> ä¾‹ç¨‹ï¼š[åˆ‡è›‹ç³• - AcWing](https://www.acwing.com/activity/content/code/content/8475415/)
>
> å®˜æ–¹ï¼š[sortedlist.py - grantjenks/python-sortedcontainers](https://github.com/grantjenks/python-sortedcontainers/blob/master/src/sortedcontainers/sortedlist.py)

æœ‰åºåˆ—è¡¨ç±»ã€‚å¯¼å…¥æ–¹æ³• `from sortedcontainers import SortedList`ã€‚å¯ä»¥ç±»æ¯” C++ ä¸­çš„ `map` ç±»ã€‚å…±æœ‰ä»¥ä¸‹å†…å®¹ï¼Œå…¨éƒ¨éƒ½æ˜¯ $O(\log n)$ çš„æ—¶é—´å¤æ‚åº¦ï¼š

1. `add(value)`: æ·»åŠ ä¸€ä¸ªå€¼åˆ°æœ‰åºåˆ—è¡¨
2. `discard(value)`: åˆ é™¤åˆ—è¡¨ä¸­çš„å€¼ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
3. `remove(value)`: åˆ é™¤åˆ—è¡¨ä¸­çš„å€¼ï¼ˆå¿…é¡»å­˜åœ¨ï¼‰
4. `pop(index=-1)`: åˆ é™¤å¹¶è¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å€¼
5. `bisect_left(value)`: è¿”å›æ’å…¥å€¼çš„æœ€å·¦ç´¢å¼•
6. `bisect_right(value)`: è¿”å›æ’å…¥å€¼çš„æœ€å³ç´¢å¼•
7. `count(value)`: è®¡ç®—å€¼åœ¨åˆ—è¡¨ä¸­çš„å‡ºç°æ¬¡æ•°

**Treap**ã€‚äºŒå‰æœç´¢æ ‘å’Œå †çš„ç»“åˆä½“ã€‚å®ƒé€šè¿‡ç»´æŠ¤ä¸¤ç§æ€§è´¨æ¥ä¿æŒå¹³è¡¡ï¼š

- äºŒå‰æœç´¢æ ‘æ€§è´¨ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹å€¼å°äºè¯¥èŠ‚ç‚¹çš„å€¼ï¼Œå³å­æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹å€¼å¤§äºè¯¥èŠ‚ç‚¹çš„å€¼ã€‚
- å †æ€§è´¨ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„ä¼˜å…ˆçº§ï¼ˆé€šå¸¸éšæœºç”Ÿæˆï¼‰è¦å¤§äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„ä¼˜å…ˆçº§ã€‚

å¹³è¡¡æœºåˆ¶ï¼š

- Treap ä½¿ç”¨éšæœºåŒ–ä¼˜å…ˆçº§ä½¿å¾—æ ‘çš„å½¢çŠ¶æ¥è¿‘äºç†æƒ³çš„å¹³è¡¡æ ‘ï¼ˆæœŸæœ›æ ‘é«˜ä¸º $O(\log n)$ï¼‰ã€‚
- é€šè¿‡æ—‹è½¬æ“ä½œï¼ˆå·¦æ—‹å’Œå³æ—‹ï¼‰åœ¨æ’å…¥å’Œåˆ é™¤æ—¶ä¿æŒå †çš„æ€§è´¨ã€‚

ä¼˜ç‚¹ï¼š

- å®ç°ç›¸å¯¹ç®€å•ã€‚
- ç”±äºéšæœºåŒ–çš„ä¼˜å…ˆçº§ï¼Œåœ¨æœŸæœ›æƒ…å†µä¸‹ï¼Œæ ‘çš„é«˜åº¦æ˜¯ $O(\log n)$ã€‚
- çµæ´»æ€§é«˜ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ä¼˜å…ˆçº§å‡½æ•°ã€‚

ç¼ºç‚¹ï¼š

- æœ€åæƒ…å†µä¸‹ï¼Œæ ‘çš„é«˜åº¦å¯èƒ½é€€åŒ–ä¸º $O(n)$ï¼ˆä¾‹å¦‚æ‰€æœ‰ä¼˜å…ˆçº§ç›¸åŒæˆ–é¡ºåºç”Ÿæˆçš„ä¼˜å…ˆçº§ï¼‰ï¼Œå°½ç®¡å‘ç”Ÿæ¦‚ç‡å¾ˆä½ã€‚

**AVL æ ‘**ã€‚æ˜¯æœ€æ—©è¢«å‘æ˜å‡ºæ¥çš„çš„è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œ1962 å¹´ç”± Adelson-Velsky å’Œ Landis å‘æ˜ã€‚

- å®šä¹‰ï¼šå¹³è¡¡å› å­ä¸ºå·¦å­æ ‘çš„é«˜åº¦ - å³å­æ ‘çš„é«˜åº¦ï¼Œå¹³è¡¡äºŒå‰æ ‘çš„å¹³è¡¡å› å­ç»å¯¹å€¼ $\le$ 1ï¼›
- æ„å»ºï¼šå½“æ’å…¥ç»“ç‚¹è¿›è¡Œæ„å»ºæ—¶å‡ºç°äº†æœ‰ç»“ç‚¹å¹³è¡¡å› å­çš„ç»å¯¹å€¼è¶…è¿‡äº† 1ï¼Œåˆ™è¿›è¡Œâ€œæ—‹è½¬â€è°ƒæ•´ï¼Œæ—‹è½¬å…±åˆ†ä¸º 4 ç§ï¼Œå·¦æ—‹è½¬ã€å³æ—‹è½¬ã€å·¦å³åŒæ—‹è½¬å’Œå³å·¦åŒæ—‹è½¬ï¼›
- å¹³è¡¡æœºåˆ¶ï¼šæ’å…¥æˆ–åˆ é™¤èŠ‚ç‚¹åï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹çš„å¹³è¡¡å› å­ä¸å†ä¸º $-1$ã€$0$ æˆ– $1$ï¼Œå°±éœ€è¦é€šè¿‡æ—‹è½¬ï¼ˆå•æ—‹è½¬æˆ–åŒæ—‹è½¬ï¼‰æ¥æ¢å¤å¹³è¡¡ã€‚
- ä¼˜ç‚¹ï¼šä¸¥æ ¼çš„å¹³è¡¡æ¡ä»¶ä¿è¯äº†æ ‘çš„é«˜åº¦å§‹ç»ˆä¸º $O(\log n)$ï¼Œå› æ­¤æœç´¢ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º $O(\log n)$ï¼›
- ç¼ºç‚¹ï¼šç”±äºå¹³è¡¡æ¡ä»¶ä¸¥æ ¼ï¼Œæ¯æ¬¡æ’å…¥å’Œåˆ é™¤åå¯èƒ½éœ€è¦è¾ƒå¤šçš„æ—‹è½¬æ“ä½œï¼Œä»è€Œå¯¼è‡´å®ç°è¾ƒå¤æ‚ï¼Œæ’å…¥å’Œåˆ é™¤æ“ä½œçš„å¸¸æ•°æ—¶é—´å¼€é”€è¾ƒå¤§ã€‚

ä¸‹é¢å››å¼ å›¾æ¼”ç¤ºäº†å››ç§æ—‹è½¬é€»è¾‘ï¼š

=== "LL å‹è°ƒæ•´è¿‡ç¨‹"
    ![LL å‹è°ƒæ•´è¿‡ç¨‹](https://cdn.dwj601.cn/images/20250605110429804.png)

=== "RR å‹è°ƒæ•´è¿‡ç¨‹"
    ![RR å‹è°ƒæ•´è¿‡ç¨‹](https://cdn.dwj601.cn/images/20250605110426398.png)

=== "LR å‹è°ƒæ•´è¿‡ç¨‹"
    ![LR å‹è°ƒæ•´è¿‡ç¨‹](https://cdn.dwj601.cn/images/202406292218547.png)

=== "RL å‹è°ƒæ•´è¿‡ç¨‹"
    ![RL å‹è°ƒæ•´è¿‡ç¨‹](https://cdn.dwj601.cn/images/202406292218548.png)

å°è¯•æ¨¡æ‹Ÿä¸€éä¸‹åˆ—åºåˆ—çš„æ„é€ è¿‡ç¨‹å°±å¯ä»¥ç†è§£äº†ï¼š

![ä¾‹é¢˜](https://cdn.dwj601.cn/images/202406292218549.png)

**çº¢é»‘æ ‘**ã€‚ä¸€ç§è¾ƒä¸ºå®½æ¾çš„è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œç”± Rudolf Bayer äº 1972 å¹´å‘æ˜ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰çº¢è‰²æˆ–é»‘è‰²ä¸¤ç§é¢œè‰²ï¼Œé€šè¿‡è¿™äº›é¢œè‰²çº¦æŸæ ‘çš„å¹³è¡¡æ€§ã€‚

- å¹³è¡¡æœºåˆ¶ï¼šæ’å…¥å’Œåˆ é™¤æ“ä½œå¯èƒ½ç ´åçº¢é»‘æ ‘çš„æ€§è´¨ï¼Œéœ€è¦é€šè¿‡é‡æ–°ç€è‰²å’Œæ—‹è½¬æ¥æ¢å¤å¹³è¡¡ã€‚é€šè¿‡éµå¾ªçº¢é»‘æ ‘çš„äº”ä¸ªæ€§è´¨æ¥ä¿æŒå¹³è¡¡ï¼š
    1. æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰²ï¼›
    2. æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼›
    3. å¶å­èŠ‚ç‚¹ï¼ˆNIL èŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²ï¼›
    4. å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œé‚£ä¹ˆå®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²ï¼ˆçº¢èŠ‚ç‚¹ä¸èƒ½è¿ç»­å‡ºç°ï¼‰ï¼›
    5. ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°é‡çš„é»‘è‰²èŠ‚ç‚¹ã€‚
- ä¼˜ç‚¹ï¼šçº¢é»‘æ ‘çš„é«˜åº¦æœ€å¤šæ˜¯ $\Theta (2  \log n)$ï¼Œå› æ­¤æœç´¢ã€æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä»ä¸º $O(\log n)$ï¼›ç”±äºå¹³è¡¡æ¡ä»¶è¾ƒä¸ºå®½æ¾ï¼Œæ’å…¥å’Œåˆ é™¤æ“ä½œéœ€è¦çš„æ—‹è½¬æ“ä½œé€šå¸¸æ¯” AVL æ ‘å°‘ï¼Œæ•ˆç‡æ›´é«˜ï¼›
- ç¼ºç‚¹ï¼šå®ç°è¾ƒå¤æ‚ï¼Œç‰¹åˆ«æ˜¯æ’å…¥å’Œåˆ é™¤çš„å¹³è¡¡ä¿®å¤è¿‡ç¨‹ï¼›è™½ç„¶çº¢é»‘æ ‘çš„æœç´¢æ•ˆç‡ä¸ AVL æ ‘ç›¸ä¼¼ï¼Œä½†ç”±äºå¹³è¡¡æ¡ä»¶è¾ƒå®½æ¾ï¼Œå®é™…åº”ç”¨ä¸­çš„æ ‘é«˜åº¦é€šå¸¸ç•¥é«˜äº AVL æ ‘ï¼Œå› æ­¤æœç´¢æ“ä½œçš„æ•ˆç‡ç¨ä½ã€‚

### ä¾‹ï¼šéå†é—®é¢˜

> ç»å…¸ä¹‹å¤„ï¼šäºŒå‰æ ‘åºåˆ—é—®é¢˜
>
> éš¾åº¦ï¼šæ´›è°· é»„
>
> OJï¼š[æ´›è°·](https://www.luogu.com.cn/problem/P1229)

é¢˜æ„ï¼šç»™å®šä¸€æ£µäºŒå‰æ ‘çš„å‰åºå’Œååºéå†åºåˆ— $a,b\ (1\le \lvert a\rvert = \lvert b \rvert\le n)$ï¼ŒåŒä¸€ä¸ªåºåˆ—ä¸­ä¸å­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„å…ƒç´ ã€‚é—®ä¸­åºéå†åºåˆ—çš„å¯èƒ½æƒ…å†µæœ‰å¤šå°‘ç§ã€‚

æ€è·¯ï¼š

- æˆ‘ä»¬å°†äºŒå‰æ ‘çš„æ¯ä¸€ä¸ªç»“ç‚¹éƒ½æŠ½è±¡ä¸ºã€Œæ ¹ç»“ç‚¹ã€å·¦å­æ ‘ã€å³å­æ ‘ã€çš„ç»“æ„ã€‚æ˜¾ç„¶ï¼Œå¦‚æœä¸€ä¸ªç»“ç‚¹çš„å·¦å³å­æ ‘éƒ½å­˜åœ¨æˆ–è€…éƒ½ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¸­åºåºåˆ—çš„æƒ…å†µæ˜¯å”¯ä¸€çš„ï¼Œå½“ä¸”ä»…å½“ç¼ºå°‘å·¦å­æ ‘æˆ–ç¼ºå°‘å³å­æ ‘æ—¶ï¼Œä¸­åºåºåˆ—æ‰ä¼šå‡ºç°ä¸¤ç§å¯èƒ½çš„æƒ…å†µï¼Œå³å”¯ä¸€å­˜åœ¨çš„é‚£æ£µå­æ ‘å¯ä»¥æ˜¯å·¦å­æ ‘ä¹Ÿå¯ä»¥æ˜¯å³å­æ ‘ã€‚è€Œä¸€æ—¦æœ‰ä¸€ä¸ªå•åˆ†æ”¯ç»“ç‚¹ï¼Œç­”æ¡ˆæ•°å°±ä¼šç¿»å€ï¼Œå› æ­¤æœ¬é¢˜å°±è½¬åŒ–ä¸ºäº†å¯»æ‰¾äºŒå‰æ ‘ä¸­çš„å•åˆ†æ”¯ç»“ç‚¹æ•°ï¼›
- å¦‚ä½•æ ¹æ®å‰åºå’Œååºéå†åºåˆ—åˆ¤å®šå•åˆ†æ”¯ç»“ç‚¹å‘¢ï¼Ÿæˆ‘ä»¬æŠŠæ‰€æœ‰çš„æƒ…å†µéƒ½ç½—åˆ—ä¸€ä¸‹ï¼Œå°è¯•å¯»æ‰¾ã€Œåªå­˜åœ¨ä¸€ä¸ªåˆ†æ”¯çš„åºåˆ—ã€å’Œã€Œä¸å­˜åœ¨åˆ†æ”¯æˆ–å­˜åœ¨ä¸¤ä¸ªåˆ†æ”¯çš„åºåˆ—ã€çš„ä¸åŒä¹‹å¤„ã€‚ç®€å•åˆ†æåä¸éš¾å‘ç°ï¼Œåªå­˜åœ¨ä¸€ä¸ªåˆ†æ”¯çš„å‰åºä¸ååºåºåˆ—å…·å¤‡ã€Œä¸€çº§æ ¹å’ŒäºŒçº§æ ¹ç›¸é‚»ã€çš„ç‰¹ç‚¹ï¼Œåä¹‹ä¸å…·å¤‡ã€‚ä¸ºäº†æ‰¾åˆ°è¿™æ ·çš„ç›¸é‚»å…ƒç´ ï¼ŒåŒé‡å¾ªç¯åˆ¤æ–­ä¸€ä¸‹å³å¯ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$

=== "Python"

    ```python
    a, b = input().strip(), input().strip()
    
    cnt = 0
    for i in range(len(a) - 1):
        for j in range(1, len(b)):
            cnt += a[i] == b[j] and a[i + 1] == b[j - 1]
    
    print(1 << cnt)
    ```

=== "C++"

    ```cpp
    #include <iostream>
    using namespace std;
    
    int main() {
        string a, b;
        cin >> a >> b;
    
        int cnt = 0;
        for (int i = 0; i < a.size() - 1; i++) {
            for (int j = 1; j < b.size(); j++) {
                cnt += a[i] == b[j] && a[i + 1] == b[j - 1];
            }
        }
    
        cout << (1 << cnt) << "\n";
    
        return 0;
    }
    ```

åŒç±»é¢˜æ¨èï¼š

- [æ´›è°· æ©™ | ç¾å›½è¡€ç»Ÿ | æ´›è°· - (www.luogu.com.cn)](https://www.luogu.com.cn/problem/P1827)
- [æ´›è°· é»„ | äºŒå‰æ ‘é—®é¢˜ | æ´›è°· - (www.luogu.com.cn)](https://www.luogu.com.cn/problem/P3884)

### ä¾‹ï¼šåŒ»é™¢è®¾ç½®ğŸ¤¨

> ç»å…¸ä¹‹å¤„ï¼šå¸¦æƒæ ‘çš„é‡å¿ƒ
>
> éš¾åº¦ï¼š$1\le n \le100$ éš¾åº¦ä¸ºæ´›è°· é»„ï¼Œ$1\le n\le 10^5$ éš¾åº¦çº¦ä¸ºæ´›è°· ç»¿
>
> OJï¼š[æ´›è°·](https://www.luogu.com.cn/problem/P1364)

é¢˜æ„ï¼šç»™å®šä¸€æ£µå«æœ‰ $n\ (1\le n\le 100)$ ä¸ªç»“ç‚¹çš„äºŒå‰æ ‘ï¼Œå«æœ‰ç‚¹æƒ $w\ (1\le w_i\le10^5)$ å’Œè¾¹æƒ $e\ (e_i=1)$ã€‚å¯»æ‰¾ç›®æ ‡ç»“ç‚¹ï¼Œä½¿å¾—æ‰€æœ‰ç»“ç‚¹åˆ°è¯¥ç‚¹çš„è·¯å¾„å’Œï¼ˆç‚¹æƒä¹˜ä»¥è¯¥ç‚¹åˆ°ç›®æ ‡ç»“ç‚¹çš„æœ€çŸ­è·¯å¾„é•¿åº¦ï¼‰æœ€å°ï¼Œè¾“å‡ºæœ€å°è·¯å¾„å’Œã€‚

æ€è·¯ï¼š

- æœ€æœ´ç´ çš„åšæ³•æ¯”è¾ƒæ˜¾ç„¶ï¼Œæšä¸¾æ¯ä¸€ä¸ªç‚¹ç„¶å DFS æˆ– BFS ä¸€éå³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(n^2)$ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡æœ¬é¢˜ï¼Œä½†æ•°æ®é‡ä¸€æ—¦è°ƒå¤§å°±æŒ‚äº†ï¼Œè€ƒè™‘ä¼˜åŒ–ï¼›
- å¸¦æƒæ ‘çš„é‡å¿ƒï¼ŒTODOã€‚

### ä¾‹ï¼šæ ‘çš„ç›´å¾„

> ç»å…¸ä¹‹å¤„ï¼šæ ‘çš„ç›´å¾„æ€§è´¨è¿ç”¨ã€é€šè¿‡åŠ¨æ€ LCA å¿«é€Ÿæ±‚è§£æ ‘ä¸Šä»»æ„ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»
>
> OJï¼š[AcWing](https://www.acwing.com/problem/content/5563/)
>
> éš¾åº¦ï¼šCF 1500 *

é¢˜æ„ï¼šç»™å®šä¸€æ£µæœ‰æ ¹æ ‘ï¼Œåˆå§‹æ—¶å«æœ‰ $4$ ä¸ªç»“ç‚¹ï¼Œç¼–å·åˆ†åˆ«ä¸º $1$ åˆ° $4$ï¼Œå…¶ä¸­ $1$ å·ä¸ºæ ¹ç»“ç‚¹ï¼Œ$2$ åˆ° $4$ å‡ä¸ºæ ¹ç»“ç‚¹çš„å¶å­ç»“ç‚¹ã€‚ç°åœ¨è¿›è¡Œ $q\ (1\le q\le 5 \times 10^5)$ æ¬¡æ“ä½œï¼Œæ¯æ¬¡æŒ‡å®šä¸€ä¸ªå·²ç»å­˜åœ¨çš„å¶ç»“ç‚¹å¹¶ä¸ºå…¶æ·»åŠ ä¸¤ä¸ªæ–°ç»“ç‚¹ä½œä¸ºå¶èŠ‚ç‚¹ï¼Œæ–°ç»“ç‚¹ç¼–å·ä» $5$ å¼€å§‹é€’å¢ã€‚æ¯æ¬¡æ“ä½œåè¾“å‡ºè¿™æ£µæ ‘çš„ç›´å¾„ï¼Œæ ‘ä¸­è¾¹æƒå‡ä¸º $1$ã€‚

æ€è·¯ï¼š

- å¦‚æœç›´æ¥ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„ [ç¦»çº¿æ³•æ±‚æ ‘çš„ç›´å¾„](#æ ‘çš„ç›´å¾„)ï¼Œé‚£ä¹ˆæ¯æ¬¡æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ $O(n)$ çš„ï¼Œå…¶ä¸­ $n$ ä¸ºæ ‘ä¸­ç»“ç‚¹æ•°é‡ï¼Œæ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(qn)$ï¼Œè‚¯å®šä¼šè¶…æ—¶ï¼Œè€ƒè™‘ä¼˜åŒ–ï¼›
- å¯¹äºä»»ä¸€å±€é¢ï¼Œè®°æ–°æ’å…¥çš„ä¸¤ä¸ªå¶ç»“ç‚¹åˆ†åˆ«ä¸º $x_1$ å’Œ $x_2$ï¼Œæ˜¾ç„¶è¿™ä¸¤ä¸ªç»“ç‚¹å¯¹ç›´å¾„çš„å½±å“æ˜¯ç­‰ä»·çš„ï¼Œå› æ­¤å°†å…¶ç»Ÿä¸€è®°ä½œ $x$ã€‚æ ‘çš„ç›´å¾„çš„ä¸¤ä¸ªç«¯ç‚¹è®°ä½œ $u$ å’Œ $v$ã€‚ä»»æ„ä¸¤ç‚¹ä¹‹é—´ $a,b$ çš„è·ç¦»è®°ä½œ $h_{a,b}$ï¼Œä»»æ„ä¸€ç‚¹ $c$ çš„æ·±åº¦è®°ä½œ $d_c$ï¼›
- å®¹æ˜“ç”¨åè¯æ³•è¯æ˜ï¼Œ$x$ æœ€å¤šåªä¼šé¡¶æ›¿ç›´å¾„çš„ä¸€ä¸ªç«¯ç‚¹ã€‚å› æ­¤æˆ‘ä»¬åœ¨åˆ¤æ–­æ ‘çš„ç›´å¾„æ˜¯å¦å˜åŒ–æ—¶ï¼Œåªéœ€è¦è®¡ç®— $h_{u,x}$ å’Œ $h_{v,x}$ æ˜¯å¦è¶…è¿‡åŸæ¥çš„ç›´å¾„é•¿åº¦å³å¯ï¼›
- æˆ‘ä»¬è‚¯å®šä¸èƒ½ DFS/BFS æ•´æ£µæ ‘æ¥è®¡ç®— $h_{u,x}$ å’Œ $h_{v,x}$ã€‚è¿™é‡Œæˆ‘ä»¬å€ŸåŠ© LCA çš„ trickï¼š$h_{a,b}=d_a+d_b-2\times d_{\text{lca}(a,b)}$ï¼Œå…¶ä¸­æ·±åº¦æ•°ç»„ $d$ å¯ä»¥åœ¨æ’å…¥æ–°ç‚¹æ—¶ $O(1)$ ç»´æŠ¤ï¼ŒLCA çš„ç¥–å…ˆæ•°ç»„ $f$ å¯ä»¥åœ¨æ’å…¥æ–°ç‚¹æ—¶ $O(\log n)$ ç»´æŠ¤ã€‚ä»è€Œåšåˆ°åœ¨ $O(\log n)$ çš„æ—¶é—´å¤æ‚åº¦å†…è®¡ç®—æ ‘ä¸Šä»»æ„ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(q \log n)$

```python
import sys
sys.setrecursionlimit(5 * 10**5 + 1)

II = lambda: int(input().strip())
N = 10**6 + 10

d = [0] * N  # æ·±åº¦
d[2] = d[3] = d[4] = 1
f = [[0] * 21 for _ in range(N)]
f[2][0] = f[3][0] = f[4][0] = 1
idx = 4  # ç»“ç‚¹ä¸‹æ ‡
u, v = 2, 3  # ç›´å¾„ç«¯ç‚¹çš„ä¸‹æ ‡
diameter = 2

def lca(a: int, b: int) -> int:
    if d[a] < d[b]:
        a, b = b, a
    
    for i in range(20, -1, -1):
        if d[f[a][i]] >= d[b]:
            a = f[a][i]
    
    if a == b:
        return a

    for i in range(20, -1, -1):
        if f[a][i] != f[b][i]:
            a, b = f[a][i], f[b][i]
    
    return f[a][0]

OUTs = []
for _ in range(II()):
    fa = II()
    x1, x2 = idx + 1, idx + 2
    idx += 2

    # ç»´æŠ¤æ·±åº¦
    d[x1] = d[x2] = d[fa] + 1

    # ç»´æŠ¤ç¥–å…ˆ
    f[x1][0] = f[x2][0] = fa
    for i in range(1, 21):
        f[x1][i] = f[x2][i] = f[f[x1][i - 1]][i - 1]
    
    # è®¡ç®—æ–°ç›´å¾„
    dist_x1_u = d[x1] + d[u] - 2 * d[lca(x1, u)]
    dist_x1_v = d[x1] + d[v] - 2 * d[lca(x1, v)]
    if dist_x1_u > diameter:
        v = x1
        diameter = dist_x1_u
    elif dist_x1_v > diameter:
        u = x1
        diameter = dist_x1_v

    OUTs.append(diameter)

print('\n'.join(map(str, OUTs)))
```

### ä¾‹ï¼šä»¥ç»„ä¸ºå•ä½è®¢é—¨ç¥¨ğŸ¤¨

<https://leetcode.cn/problems/booking-concert-tickets-in-groups/>

> é¢˜æ„ï¼šç»™å®šä¸€ä¸ªé•¿ä¸º $n\le 5 \times 10^4$ ä¸”åˆå§‹å€¼å‡ä¸º $0$ çš„æ•°ç»„ $a$ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æœ€å¤šå¢åŠ åˆ° $m$ã€‚ç°åœ¨éœ€è¦ä»¥è¿™ä¸ªæ•°ç»„ä¸ºåŸºç¡€è¿›è¡Œ $q\le 5 \times 10^4$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®æ˜¯ä»¥ä¸‹ä¸¤è€…ä¹‹ä¸€ï¼š
>
> 1. ç»™å®šä¸€ä¸ª $k$ å’Œ $lim$ï¼Œæ‰¾åˆ°æœ€å°çš„ $i \in [0,lim]$ ä½¿å¾— $m - a_i \ge k$
> 2. ç»™å®šä¸€ä¸ª $k$ å’Œ $lim$ï¼Œæ‰¾åˆ°æœ€å°çš„ $i \in [0,lim]$ ä½¿å¾— $\displaystyle m\times (i+1) - \sum_{j=0}^i a_j \ge k$
>
> æ€è·¯ä¸€ï¼š**æš´åŠ›**ã€‚
>
> - å¯¹äºè¯¢é—® 1ï¼Œæˆ‘ä»¬ç›´æ¥é¡ºåºéå† a æ•°ç»„ç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å³å¯ï¼›å¯¹äºè¯¢é—® 2ï¼ŒåŒæ ·ç›´æ¥é¡ºåºéå† a æ•°ç»„ç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å³å¯ï¼›
> - æ—¶é—´å¤æ‚åº¦ $O(qn)$ã€‚
>
> æ€è·¯äºŒï¼š**çº¿æ®µæ ‘ä¸ŠäºŒåˆ†**ã€‚
>
> - TODO
> - æ—¶é—´å¤æ‚åº¦ $O(q\log n)$ã€‚

æš´åŠ›ä»£ç ï¼š

```python
class BookMyShow:

    def __init__(self, n: int, m: int):
        self.a = [0] * n  # a[i] è¡¨ç¤ºç¬¬ i è¡Œå·²å…¥åº§çš„äººæ•°
        self.n = n
        self.m = m

    def gather(self, k: int, lim: int) -> List[int]:
        # åœ¨ [0, lim] è¡Œä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ä»¥å®¹çº³ k äººçš„è¡Œ
        for i in range(lim + 1):
            if self.m - self.a[i] >= k:
                l, r = i, self.a[i]
                self.a[i] += k
                return [l, r]
        return []

    def scatter(self, k: int, lim: int) -> bool:
        # åœ¨ [0, lim] è¡Œä¸­æ‰¾åˆ°æœ€å°çš„ i ä½¿å¾— [0, i] è¡Œå¯ä»¥å®¹çº³ k äºº
        if self.m * (lim + 1) - sum(self.a[:lim+1]) < k:
            return False

        i = 0
        while k > 0:
            if self.m - self.a[i] >= k:
                self.a[i] += k
                k = 0
            else:
                k -= self.m - self.a[i]
                self.a[i] = self.m
            i += 1
        return True
```

çº¿æ®µæ ‘ä¸ŠäºŒåˆ†ä»£ç ï¼š

```python

```

### ä¾‹ï¼šè¥ä¸šé¢ç»Ÿè®¡ğŸ¤¨

<https://www.luogu.com.cn/problem/P2234>

> é¢˜æ„ï¼šç»™å®šä¸€ä¸ªåºåˆ— aï¼Œéœ€è¦è®¡ç®— $a_1 + \displaystyle \sum_{i=2,1 \le j <i}^{n} \min {|a_i - a_j|}$ ï¼Œå³è®¡ç®—æ¯ä¸€ä¸ªæ•°ä¸åºåˆ—ä¸­å½“å‰æ•°ä¹‹å‰çš„æ•°çš„æœ€å°å·®å€¼ä¹‹å’Œ
>
> æ€è·¯ï¼šå¾ˆæ˜¾ç„¶çš„æ€è·¯ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ•°ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¹‹å‰çš„åºåˆ—åœ¨çŸ­æ—¶é—´å†…æ‰¾åˆ°ä¸€ä¸ªæ•°å€¼æœ€æ¥è¿‘å½“å‰æ•°çš„æ•°ã€‚
>
> - TLEï¼šä¸€å¼€å§‹çš„æ€è·¯æ˜¯æ¯æ¬¡å¯¹ä¹‹å‰çš„åºåˆ—è¿›è¡Œæ’åºï¼Œç„¶åäºŒåˆ†æŸ¥æ‰¾ä¸å½“å‰å€¼åŒ¹é…çš„æ•°ï¼Œä¸ºäº†ç¡®ä¿æ‰€æœ‰çš„æƒ…å†µéƒ½æ‰¾åˆ°ï¼Œå°±ç›´æ¥åˆ¤æ–­äºŒåˆ†æŸ¥åˆ°çš„æ•°ï¼ŒæŸ¥åˆ°çš„æ•°ä¹‹å‰çš„ä¸€ä¸ªæ•°ï¼Œä¹‹åçš„ä¸€ä¸ªæ•°ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦æé«˜ï¼ˆæˆ‘å±…ç„¶æ²¡æƒ³åˆ°ï¼‰ï¼Œæ˜¯ $O(n^2 \log n)$
> - ACï¼šåæ¥çœ‹äº†é¢˜è§£æ‰çŸ¥é“ `set` çš„æ­£ç¡®ç”¨æ³•ï¼Œå°±æ˜¯ä¸€ä¸ª **å¹³è¡¡æ ‘çš„ STL**ã€‚æˆ‘ä»¬å¯¹äºä¹‹å‰çš„åºåˆ—ä¸æ–­çš„æ’å…¥å¹³è¡¡æ ‘ä¸­ï¼ˆé»˜è®¤å‡åºæ’åºï¼‰ï¼Œæ¯æ¬¡åˆ©ç”¨ `s.lower_bound(x)` è¿”å›ã€Œé›†åˆ `s` ä¸­ç¬¬ä¸€ä¸ª $\ge$ å½“å‰æ•°çš„è¿­ä»£å™¨ã€ï¼Œç„¶åè¿›è¡Œåˆ¤æ–­å³å¯ã€‚`lower_bound()` çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(\log n)$ ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¾¹ç•Œçš„åˆ¤æ–­ï¼Œä¸€å¼€å§‹çš„æ€è·¯è™½ç„¶ä¼šè¶…æ—¶ï¼Œä½†æ˜¯äºŒåˆ†åè¾¹ç•Œçš„åˆ¤æ–­å¾ˆç®€å•ï¼Œä½¿ç”¨ STL ååŒæ ·éœ€è¦è€ƒè™‘è¾¹ç•Œçš„æƒ…å†µã€‚åˆ†ä¸ºä¸‰ç§ï¼ˆè¯¦æƒ…è§ä»£ç ï¼‰
>     - å½“å‰æ•°æ¯”é›†åˆä¸­æ‰€æœ‰çš„æ•°éƒ½å¤§ï¼Œé‚£ä¹ˆ `lower_bound` å°±ä¼šè¿”å› `s.end()` ç­”æ¡ˆå°±æ˜¯å½“å‰æ•°ä¸é›†åˆä¸­æœ€åä¸€ä¸ªæ•°çš„å·®å€¼
>     - å½“å‰æ•°æ¯”é›†åˆä¸­æ‰€æœ‰çš„æ•°éƒ½å°ï¼Œé‚£ä¹ˆ `lower_bound` å°±ä¼šè¿”å› `s.bigin()` ç­”æ¡ˆå°±æ˜¯é›†åˆä¸­ç¬¬ä¸€ä¸ªæ•°ä¸å½“å‰æ•°çš„å·®å€¼
>     - å½“å‰æ•°å­˜åœ¨äºé›†åˆä¸­ or é›†åˆä¸­æ—¢æœ‰æ¯”å½“å‰æ•°å¤§çš„åˆæœ‰æ¯”å½“å‰æ•°å°çš„ï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒæŸ¥åˆ°çš„æ•°ä¸æŸ¥åˆ°çš„æ•°å‰ä¸€ä¸ªæ•°å’Œå½“å‰æ•°çš„å·®å€¼ï¼Œå–æœ€å°çš„å·®å€¼å³å¯
>
> æ—¶é—´å¤æ‚åº¦ï¼š$O(n \log n)$

TLE ä½†é€»è¾‘æ¸…æ™°ä»£ç 

```cpp
#include <iostream>
#include <algorithm>
using namespace std;

const int N = 1 << 16;

int n, a[N];

void solve() {
    cin >> n;
    
    int res = 0;
    cin >> a[1];
    res += a[1];
    
    for (int i = 2; i <= n; i++) {
        // ç»´æŠ¤ä¹‹å‰åºåˆ—æœ‰åº
        sort(a + 1, a + i);
        cin >> a[i];

        // äºŒåˆ†æŸ¥æ‰¾ç›®æ ‡æ•°
        int l = 1, r = i - 1;
        while (l < r) {
            int mid = (l + r) >> 1;
            if (a[mid] < a[i]) l = mid + 1;
            else r = mid;
        }
        
        // è¾¹ç•Œåˆ¤æ–­
        int ans = abs(a[i] - a[r]);
        if (r + 1 >= 1 && r + 1 <= i - 1) ans = min(ans, abs(a[i] - a[r + 1]));
        if (r - 1 >= 1 && r - 1 <= i - 1) ans = min(ans, abs(a[i] - a[r - 1]));
        
        res += ans;
    }
    
    cout << res << "\n";
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

AC çš„ set ä»£ç 

```cpp
#include <iostream>
#include <algorithm>
#include <set>
using namespace std;

int n, res;
set<int> s;

void solve() {
    cin >> n;
    
    int x;
    cin >> x;
    res += x;
    s.insert(x);
    
    while (--n) {
        cin >> x;

        auto it = s.lower_bound(x);

        if (it == s.end()) {
            // æ²¡æœ‰æ¯”å½“å‰æ•°å¤§çš„
            res += x - *s.rbegin();
        } else if (it == s.begin()) {
            // æ²¡æœ‰æ¯”å½“å‰æ•°å°çš„
            res += *s.begin() - x;
        } else {
            // å½“å‰æ•°å·²å­˜åœ¨äºé›†åˆä¸­ or æ—¢æœ‰æ¯”å½“å‰æ•°å¤§çš„ä¹Ÿæœ‰æ¯”å½“å‰æ•°å°çš„
            auto pre = it;
            pre--;
            res += min(abs(x - *it), abs(x - *pre));
        }
        
        s.insert(x);
    }
    
    cout << res << "\n";
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

### ä¾‹ï¼šåˆ‡è›‹ç³•ğŸ¤¨

<https://www.acwing.com/problem/content/description/5581/>

> é¢˜æ„ï¼šç»™å®šä¸€ä¸ªçŸ©å½¢ï¼Œç”±å·¦ä¸‹è§’å’Œå³ä¸Šè§’çš„åæ ‡ç¡®å®šã€‚ç°åœ¨å¯¹è¿™ä¸ªçŸ©å½¢è¿›è¡Œåˆ‡å‰²æ“ä½œï¼Œè¦ä¹ˆç«–ç€åˆ‡ï¼Œè¦ä¹ˆæ¨ªç€åˆ‡ã€‚ç°åœ¨éœ€è¦ç»™å‡ºæ¯æ¬¡åˆ‡å‰²åæœ€å¤§å­çŸ©å½¢çš„é¢ç§¯
>
> æ€è·¯ï¼šSTL setã€‚å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œæ¨ªçºµåæ ‡æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæœ€å¤§å­çŸ©å½¢é¢ç§¯ä¸€å®šäº§ç”Ÿäºæœ€å¤§é•¿åº¦ä¸æœ€å¤§å®½åº¦çš„ä¹˜ç§¯ã€‚å› æ­¤æˆ‘ä»¬åªéœ€è¦ç»´æŠ¤ä¸€ä¸ªåºåˆ—çš„æœ€å¤§å€¼å³å¯ã€‚å¯¹äºäºŒç»´å¯ä»¥ç›´æ¥å½“åšä¸€ç»´æ¥çœ‹ï¼Œäºæ˜¯é—®é¢˜å°±å˜æˆäº†ï¼Œéœ€è¦åœ¨ $\log n$ çš„æ—¶é—´å¤æ‚åº¦å†…ï¼Œå¯¹ä¸€ä¸ªåºåˆ—å®Œæˆä¸‹é¢ä¸‰ä¸ªæ“ä½œï¼š
>
> 1. åˆ é™¤ä¸€ä¸ªæ•°
> 2. å¢åŠ ä¸€ä¸ªæ•°ï¼ˆæ‰§è¡Œä¸¤æ¬¡ï¼‰
> 3. è·å–æœ€å¤§å€¼
>
> å¦‚ä½•å®ç°å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦æœ‰åºè®°å½•æ¯ä¸€ä¸ªå­çº¿æ®µçš„é•¿åº¦ï¼Œå¹¶ä¸”å­çº¿æ®µçš„é•¿åº¦å¯èƒ½é‡å¤ï¼Œå› æ­¤æˆ‘ä»¬ç”¨ `std::multiset` æ¥å­˜å‚¨æ‰€æœ‰å­çº¿æ®µçš„é•¿åº¦
>
> 1. ä½¿ç”¨ `M.erase(M.find(value))` å®ç°ï¼šåˆ é™¤ä¸€ä¸ªå­çº¿æ®µé•¿åº¦å€¼
> 2. ä½¿ç”¨ `M.insert(value)` å®ç°ï¼šå¢åŠ å­çº¿æ®µä¸€ä¸ªé•¿åº¦å€¼
> 3. ä½¿ç”¨ `*M.rbegin()` å®ç°ï¼šè·å–å½“å‰æ‰€æœ‰å­çº¿æ®µé•¿åº¦çš„æœ€å¤§å€¼
>
> ç”±äºç»™çš„æ˜¯åˆ‡å‰²çš„ä½ç½®åæ ‡ `x`ï¼Œå› æ­¤ä¸Šè¿°æ“ä½œ 1 ä¸èƒ½ç›´æ¥å®ç°ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ç»™å®šçš„åˆ‡å‰²åæ ‡ `x` è®¡ç®—å‡ºå½“å‰åˆ‡å‰²ä½ç½®å¯¹åº”å­çº¿æ®µçš„é•¿åº¦ã€‚å¦‚ä½•å®ç°å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºå½“å‰åˆ‡å‰²çš„åæ ‡ `x`ï¼Œå¯¹åº”çš„å­çº¿æ®µçš„é•¿åº¦å–å†³äºå½“å‰åˆ‡å‰²åæ ‡å·¦å³ä¸¤ä¸ªåˆ‡å‰²çš„ä½ç½® `rp, lp`ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å­˜å‚¨æ¯ä¸€ä¸ªåˆ‡å‰²çš„åæ ‡å³å¯ã€‚ç”±äºåˆ‡å‰²ä½ç½®ä¸ä¼šé‡å¤ï¼Œå¹¶ä¸”éœ€è¦åœ¨ $\log n$ çš„æ—¶é—´å¤æ‚åº¦å†…æŸ¥è¯¢åˆ°ï¼Œå› æ­¤æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ `std::set` æ¥å­˜å‚¨åˆ‡å‰²ä½ç½®
>
> æ—¶é—´å¤æ‚åº¦ï¼š$O(n \log n)$

```cpp
#include <iostream>
#include <set>
using namespace std;
using ll = long long;

void work(int x, set<int>& S, multiset<int>& M) {
    set<int>::iterator rp = S.upper_bound(x), lp = rp;
    lp--;
    S.insert(x);

    M.erase(M.find(*rp - *lp));
    M.insert(*rp - x);
    M.insert(x - *lp);
}

void solve() {
    int w, h, n;
    cin >> w >> h >> n;

    set<int> S1, S2;
    multiset<int> M1, M2;
    S1.insert(0), S1.insert(w), M1.insert(w);
    S2.insert(0), S2.insert(h), M2.insert(h);

    while (n--) {
        char op;
        int x;
        cin >> op >> x;
        if (op == 'X') work(x, S1, M1);
        else work(x, S2, M2);

        cout << (ll)*M1.rbegin() * *M2.rbegin() << "\n";
    }
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

### ä¾‹ï¼šå…ƒç´ åˆ†é…é—®é¢˜ IIğŸ¤¨

<https://leetcode.cn/problems/distribute-elements-into-two-arrays-ii/description/>

> é¢˜æ„ï¼šç»™å®š $n$ ä¸ªæ•°ï¼Œç°åœ¨éœ€è¦å°†è¿™äº›æ•°æŒ‰ç…§æŸç§è§„åˆ™åˆ†é…åˆ°ä¸¤ä¸ªæ•°ç»„ $A$ å’Œ $B$ ä¸­ã€‚åˆå§‹åŒ–åˆ†é… `nums[0]` åˆ° $A$ ä¸­ï¼Œ`nums[1]` åˆ° $B$ ä¸­ï¼Œæ¥ä¸‹æ¥å¯¹äºå‰©ä½™çš„æ¯ä¸ªå…ƒç´  `nums[i]`ï¼Œåˆ†é…å–å†³äº $A$ å’Œ $B$ ä¸­æ¯”å½“å‰å…ƒç´  `nums[i]` å¤§çš„ä¸ªæ•°ï¼Œæœ€ç»ˆè¿”å›ä¸¤ä¸ªåˆ†é…å¥½çš„æ•°ç»„
>
> æ€è·¯ï¼šé¦–å…ˆæ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦è¿›è¡Œæšä¸¾ï¼Œé‚£ä¹ˆæœ¬é¢˜éœ€è¦è€ƒè™‘çš„å°±æ˜¯å¦‚ä½•åœ¨ $\log$ æ—¶é—´å¤æ‚åº¦å†…ç»Ÿè®¡å‡ºä¸¤æ•°ç»„ä¸­æ¯”å½“å‰å…ƒç´ å¤§çš„å…ƒç´ ä¸ªæ•°ã€‚é’ˆå¯¹ C++ å’Œ Python åˆ†åˆ«è®¨è®º
>
> - C++
>     - æ³•ä¸€ï¼š`std::multiset<int>`ã€‚å¯æƒœä¸è¡Œï¼Œå› ä¸ºç»Ÿè®¡æ¯”å½“å‰å…ƒç´ å¤§çš„ä¸ªæ•°æ—¶ï¼Œ`s.rbegin() - s.upper_bound(nums[i])` æ˜¯ä¸åˆæ³•çš„ï¼Œå› ä¸º `std::multiset<int>` çš„è¿­ä»£å™¨ä¸æ˜¯åŸºäºæŒ‡é’ˆçš„ï¼Œå› æ­¤æ— æ³•ç›´æ¥è¿›è¡ŒåŠ å‡æ¥è®¡ç®—åœ°å€å·®ï¼Œé‚ä½œç½¢
>     - æ³•äºŒï¼šæ ‘çŠ¶æ•°ç»„ã€‚å¾ˆå®¹æ˜“æƒ³åˆ°åˆ©ç”¨å‰ç¼€å’Œç»Ÿè®¡æ¯”å½“å‰æ•°å¤§çš„æ•°å­—ä¸ªæ•°ï¼Œä½†æ˜¯ç”±äºæ­¤å¤„éœ€è¦å¯¹å‰ç¼€å’Œè¿›è¡Œå•ç‚¹ä¿®æ”¹ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦è‚¯å®šä¼šå¯„ã€‚æœ‰ä»€ä¹ˆæ•°æ®ç»“æ„æ”¯æŒã€Œå•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æ›´æ–°ã€å‘¢ï¼Ÿæˆ‘ä»¬å¼•å…¥æ ‘çŠ¶æ•°ç»„ã€‚æˆ‘ä»¬å°†æ•°ç»„å…ƒç´ å“ˆå¸Œåˆ° `[1, len(set(nums))]` åŒºé—´ï¼Œå®šä¹‰å“ˆå¸Œåçš„å½“å‰å…ƒç´  `nums[i]` ä¸º `x`ï¼Œå¯¹äºå½“å‰å“ˆå¸Œåçš„ `x` è€Œè¨€æƒ³è¦çŸ¥é“ä¸¤ä¸ªæ•°ç»„ä¸­æœ‰å¤šå°‘æ•°æ¯”å½“å‰æ•°ä¸¥æ ¼å¤§ï¼Œåªéœ€è¦è®¡ç®—å‰ç¼€å’Œæ•°ç»„ `arr` ä¸­ `arr[n] - arr[x]` çš„ç»“æœå³å¯
> - Python
>     - `SortedList`ã€‚python æœ‰ä¸€ä¸ª `sortedcontainers` åŒ…å…¶ä¸­æœ‰ `SortedList` æ¨¡å—ï¼Œå¯ä»¥å®ç° `std::multiset<int>` æ‰€æœ‰ $\log$ æ“ä½œå¹¶ä¸”å¯ä»¥è¿›è¡Œéšæœºä¸‹æ ‡è®¿é—®ï¼Œäºæ˜¯å°±å¯ä»¥è¿›è¡Œä¸‹æ ‡è®¿é—® $O(1)$ è®¡ç®—æ¯”å½“å‰æ•°å¤§çš„å…ƒç´ ä¸ªæ•°
>
> æ—¶é—´å¤æ‚åº¦ï¼š$O(n \log n)$

```cpp
template<class T>
class BinaryIndexedTree {
private:
    std::vector<T> _arr;
    int _n;

    int lowbit(int x) { return x & (-x); }

public:
    BinaryIndexedTree(int n) :_n(n) {
        _arr.resize(_n + 1, 0);
    }

    void add(int pos, T x) {
        while (pos <= _n) {
            _arr[pos] += x;
            pos += lowbit(pos);
        }
    }

    T sum(int pos) {
        T ret = 0;
        while (pos) {
            ret += _arr[pos];
            pos -= lowbit(pos);
        }
        return ret;
    }
};


class Solution {
public:
    vector<int> resultArray(vector<int>& nums) {
        vector<int> copy = nums;
        sort(copy.begin(), copy.end());
        copy.erase(unique(copy.begin(), copy.end()), copy.end());

        int n = copy.size(), cnt = 1;
        unordered_map<int, int> a;
        for (int i = 0; i < n; i++) {
            a[copy[i]] = cnt++;
        }

        vector<int> v1, v2;
        v1.push_back(nums[0]);
        v2.push_back(nums[1]);

        BinaryIndexedTree<int> t1(n), t2(n);
        t1.add(a[nums[0]], 1);
        t2.add(a[nums[1]], 1);

        for (int i = 2; i < nums.size(); i++) {
            int d1 = t1.sum(n) - t1.sum(a[nums[i]]);
            int d2 = t2.sum(n) - t2.sum(a[nums[i]]);

            if (d1 > d2) {
                v1.push_back(nums[i]);
                t1.add(a[nums[i]], 1);                
            } else if (d1 < d2) {
                v2.push_back(nums[i]);
                t2.add(a[nums[i]], 1);
            } else if (d1 == d2 && v1.size() < v2.size()) {
                v1.push_back(nums[i]);
                t1.add(a[nums[i]], 1);
            } else if (d1 == d2 && v1.size() > v2.size()) {
                v2.push_back(nums[i]);
                t2.add(a[nums[i]], 1);
            } else {
                v1.push_back(nums[i]);
                t1.add(a[nums[i]], 1);
            }
        }

        for (int x: v2) {
            v1.push_back(x);
        }

        return v1;
    }
};
```

```python
class BinaryIndexedTree:
    def __init__(self, n: int):
        self._n = n
        self._arr = [0] * (n + 1)

    def _lowbit(self, x: int) -> int:
        return x & (-x)

    def add(self, pos: int, x: int) -> None:
        while pos <= self._n:
            self._arr[pos] += x
            pos += self._lowbit(pos)

    def sum(self, pos: int) -> int:
        ret = 0
        while pos:
            ret += self._arr[pos]
            pos -= self._lowbit(pos)
        return ret


class Solution:
    def resultArray(self, nums: List[int]) -> List[int]:
        copy = sorted(set(nums))
        
        n, cnt, a = len(copy), 1, {}
        for x in copy:
            a[x] = cnt
            cnt += 1

        v1, v2 = [nums[0]], [nums[1]]
        t1, t2 = BinaryIndexedTree(n), BinaryIndexedTree(n)
        t1.add(a[nums[0]], 1)
        t2.add(a[nums[1]], 1)
        
        for x in nums[2:]:
            d1, d2 = t1.sum(n) - t1.sum(a[x]), t2.sum(n) - t2.sum(a[x])
            
            if d1 > d2:
                v1.append(x)
                t1.add(a[x], 1)
            elif d1 < d2:
                v2.append(x)
                t2.add(a[x], 1)
            elif d1 == d2 and len(v1) < len(v2):
                v1.append(x)
                t1.add(a[x], 1)
            elif d1 == d2 and len(v1) > len(v2):
                v2.append(x)
                t2.add(a[x], 1)
            else:
                v1.append(x)
                t1.add(a[x], 1)
        
        return v1 + v2
```

```python
class Solution:
    def resultArray(self, nums: List[int]) -> List[int]:
        from sortedcontainers import SortedList
        
        v1, v2 = copy.deepcopy(nums[:1]), copy.deepcopy(nums[1:2])
        s1, s2 = SortedList(v1), SortedList(v2)

        for x in nums[2:]:
            d1, d2 = len(v1) - s1.bisect_right(x), len(v2) - s2.bisect_right(x)
            
            if d1 > d2:
                v1.append(x)
                s1.add(x)
            elif d1 < d2:
                v2.append(x)
                s2.add(x)
            elif d1 == d2 and len(v1) < len(v2):
                v1.append(x)
                s1.add(x)
            elif d1 == d2 and len(v1) > len(v2):
                v2.append(x)
                s2.add(x)
            else:
                v1.append(x)
                s1.add(x)
        
        return v1 + v2
```

## å †

å †æ˜¯ä¸€ç§åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘å®ç°çš„æ•°æ®ç»“æ„ï¼Œæ ‘ä¸­çš„ç»“ç‚¹æ‹¥æœ‰æƒå€¼ï¼ˆä¸‹åˆ—æ¯”å¤§å°å‡ä¸ºç»“ç‚¹çš„æƒå€¼æ¯”è¾ƒï¼‰ã€‚æ ¹æ®ä¸åŒçš„æ€§è´¨ï¼Œå †åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š

- è‹¥ä»»æ„ä¸€ä¸ªéå¶å­ç»“ç‚¹ $\le$ å®ƒçš„å­ç»“ç‚¹ï¼Œåˆ™ç§°è¯¥å †ä¸ºã€Œå°æ ¹å †/å°é¡¶å †ã€ï¼Œå †é¡¶å³ä¸ºå…¨å±€æœ€å°ï¼›
- è‹¥ä»»æ„ä¸€ä¸ªéå¶å­ç»“ç‚¹ $\ge$ å®ƒçš„å­ç»“ç‚¹ï¼Œåˆ™ç§°è¯¥å †ä¸ºã€Œå¤§æ ¹å †/å¤§é¡¶å †ã€ï¼Œå †é¡¶å³ä¸ºå…¨å±€æœ€å¤§ã€‚

è®°å †ä¸º `h`ï¼Œå®Œå…¨äºŒå‰æ ‘ä¸­æœ€åä¸€å±‚çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸‹æ ‡ä¸º `last`ã€‚å †å¯ä»¥åœ¨æ»¡è¶³ä¸Šè¿°æ€§è´¨çš„æƒ…å†µä¸‹é«˜æ•ˆå®Œæˆä»¥ä¸‹ä¸‰ç§æ“ä½œï¼š

- å¢ï¼Œå³å‘å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼š`heappush(h, x)`ï¼Œæ—¶é—´å¤æ‚åº¦ $O(\log n)$ã€‚å…·ä½“å®ç°ä¸Šï¼Œå¯ä»¥ä» `h[last + 1]` èµ‹æˆ `x` å¹¶é€å±‚å¾€ä¸Šä¸å…¶çˆ¶ç»“ç‚¹è¿›è¡Œæ¯”è¾ƒç„¶åæ‰§è¡Œå¯èƒ½çš„äº¤æ¢æ“ä½œï¼Œæˆ‘ä»¬å°†è¯¥æ“ä½œè®°ä½œ `up()`ï¼›
- åˆ ï¼Œå³åˆ é™¤å †é¡¶å…ƒç´ ï¼š`heappop(h)`ï¼Œæ—¶é—´å¤æ‚åº¦ $O(\log n)$ã€‚å…·ä½“å®ç°ä¸Šï¼Œå¯ä»¥ä»å°† `h[last]` æ›¿æ¢ `h[0]`ï¼Œç„¶åå°† `last -= 1` è¡¨ç¤ºå †ä¸­å°‘äº†ä¸€ä¸ªå…ƒç´ ï¼Œæœ€åå°† `h[0]` é€å±‚å¾€ä¸‹ä¸å…¶å­ç»“ç‚¹è¿›è¡Œæ¯”è¾ƒå¹¶æ‰§è¡Œå¯èƒ½çš„äº¤æ¢æ“ä½œï¼Œæˆ‘ä»¬å°†è¯¥æ“ä½œè®°ä½œ `down()`ï¼›
- æŸ¥ï¼Œå³æŸ¥è¯¢å †é¡¶å…ƒç´ ï¼š`print(h[0])`ï¼Œæ—¶é—´å¤æ‚åº¦ $O(1)$ã€‚

### ä¾‹ï¼šå †æ’åº

> å€Ÿç€è¿™é“é¢˜å°†å †çš„æ‰€æœ‰æ“ä½œå’Œå†™æ³•å…¨éƒ¨æ¢³ç†ä¸€éã€‚
>
> *æ³¨ï¼šè¿™æ˜¯ä¸€ç§ä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚
>
> *æ³¨ï¼šæœ¬é¢˜æ•°ç»„ä¸‹æ ‡ä» $0$ å¼€å§‹ã€‚

é¢˜æ„ï¼šç»™å®š $n$ ä¸ªæ•°ï¼Œè¾“å‡ºå‰ $m$ å°çš„æ•°ã€‚

æ€è·¯ï¼š

1. ç»´æŠ¤å †ç»“æ„ã€‚å¯ä»¥åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨ï¼Œå¯¹äºä¸€ä¸ªå¤§å°ä¸º $n$ çš„å®Œå…¨äºŒå‰æ ‘ï¼Œå…¶å $n/2$ ä¸ªå…ƒç´ éƒ½ä¸€å®šæ»¡è¶³å †çš„å®šä¹‰ï¼Œå› æ­¤åªéœ€è¦å¯¹å‰ $n/2$ ä¸ªå…ƒç´ æ‰§è¡Œ `down()` æ“ä½œå³å¯ï¼Œä½¿ç”¨é”™ä½ç›¸å‡æ³•å®¹æ˜“è®¡ç®—å‡ºï¼Œè¯¥æ“ä½œæ˜¯ $O(n)$ çš„ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä»æ¬¡é¡¶å±‚å¼€å§‹é€ç»“ç‚¹æ‰§è¡Œ `up()` æ“ä½œæ¥ç»´æŠ¤ï¼Œè¿™ç§åˆå§‹åŒ–æ–¹æ³•æ˜¾ç„¶å°±æ˜¯ $O(n\log n)$ çš„äº†ï¼›
2. è¾“å‡ºå †é¡¶å¹¶é‡æ–°ç»´æŠ¤å †ç»“æ„ã€‚è¾“å‡ºæ˜¯ $O(1)$ çš„ï¼Œé‡æ–°ç»´æŠ¤å †ç»“æ„å…¶å®å°±æ˜¯åˆ é™¤å®Œå…¨äºŒå‰æ ‘çš„æ ¹ç»“ç‚¹ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæŠ€å·§ï¼Œå°±æ˜¯å°†æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªæ ‘ä¸­å…ƒç´  `h[last]` æ›¿æ¢æ‰æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´  `h[0]`ï¼Œç„¶å `down(h[0])` å³å¯é‡æ–°ç»´æŠ¤å‡ºå †ç»“æ„ï¼Œè¯¥æ“ä½œæ˜¯ $O(\log n)$ çš„ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n\log n)$

=== "Python è¿­ä»£å†™æ³•"

    ```python hl_lines="5-27"
    n, m = map(int, input().strip().split())
    h = list(map(int, input().strip().split()))
    last = n - 1
    
    def down(u: int) -> None:
        t = u  # æœ€å°å€¼ä¸‹æ ‡
        l, r = 2 * u + 1, 2 * u + 2
        while True:
            # æ‰¾åˆ°æœ€å°å€¼çš„ä¸‹æ ‡
            if l <= last and h[l] < h[t]:
                t = l
            if r <= last and h[r] < h[t]:
                t = r
            # è€ƒè™‘äº¤æ¢
            if t == u:
                break
            else:
                h[t], h[u] = h[u], h[t]
                u = t
                l, r = 2 * u + 1, 2 * u + 2
    
    def up(u: int) -> None:
        fa = (u - 1) // 2
        while fa >= 0 and h[u] < h[fa]:
            h[u], h[fa] = h[fa], h[u]
            u = fa
            fa = (u - 1) // 2
    
    if __name__ == "__main__":
        # åˆå§‹åŒ–å †ç»“æ„ã€‚å†™æ³•ä¸€ï¼šä»æ¬¡åº•å±‚å¼€å§‹å¾€ä¸‹ downï¼Œæ—¶é—´å¤æ‚åº¦ O(n)
        for i in range(n // 2, -1, -1):
            down(i)
    
        # åˆå§‹åŒ–å †ç»“æ„ã€‚å†™æ³•äºŒï¼šä»æ¬¡é¡¶å±‚å¼€å§‹å¾€ä¸Š upï¼Œæ—¶é—´å¤æ‚åº¦ O(nlogn)
        # for i in range(1, n):
        #     up(i)
    
        # è¾“å‡ºå †é¡¶ + ç»´æŠ¤å †ç»“æ„
        OUTs = []
        for _ in range(m):
            # è¾“å‡ºå †é¡¶
            OUTs.append(h[0])
    
            # ç»´æŠ¤å †ç»“æ„
            h[0] = h[last]
            last -=1
            down(0)
        print(' '.join(map(str, OUTs)))
    ```

=== "Python é€’å½’å†™æ³•"

    ```python hl_lines="5-22"
    n, m = map(int, input().strip().split())
    h = list(map(int, input().strip().split()))
    last = n - 1
    
    def down(u: int) -> None:
        t = u  # æœ€å°å€¼ä¸‹æ ‡
        l, r = 2 * u + 1, 2 * u + 2
    
        if l <= last and h[l] < h[t]:
            t = l
        if r <= last and h[r] < h[t]:
            t = r
    
        if t != u:
            h[t], h[u] = h[u], h[t]
            down(t)
    
    def up(u: int) -> None:
        fa = (u - 1) // 2
        if fa >= 0 and h[u] < h[fa]:
            h[u], h[fa] = h[fa], h[u]
            up(fa)
    
    if __name__ == "__main__":
        # åˆå§‹åŒ–å †ç»“æ„ã€‚å†™æ³•ä¸€ï¼šä»æ¬¡åº•å±‚å¼€å§‹å¾€ä¸‹ downï¼Œæ—¶é—´å¤æ‚åº¦ O(n)
        # for i in range(n // 2, -1, -1):
        #     down(i)
    
        # åˆå§‹åŒ–å †ç»“æ„ã€‚å†™æ³•äºŒï¼šä»æ¬¡é¡¶å±‚å¼€å§‹å¾€ä¸Š upï¼Œæ—¶é—´å¤æ‚åº¦ O(nlogn)
        for i in range(1, n):
            up(i)
    
        # è¾“å‡ºå †é¡¶ + ç»´æŠ¤å †ç»“æ„
        OUTs = []
        for _ in range(m):
            # è¾“å‡ºå †é¡¶
            OUTs.append(h[0])
    
            # ç»´æŠ¤å †ç»“æ„
            h[0] = h[last]
            last -=1
            down(0)
        print(' '.join(map(str, OUTs)))
    ```

=== "C++ è¿­ä»£å†™æ³•"

    ```c++ hl_lines="9-41"
    #include <iostream>
    
    using namespace std;
    
    int n, m;
    int heap[100010];
    int last;
    
    void down(int u) {
        int l = 2 * u + 1;
        int r = 2 * u + 2;
        int t = u;
    
        while (true) {
            if (l <= last && heap[u] > heap[l]) {
                t = l;
            }
            if (r <= last && heap[u] > heap[r] && heap[r] < heap[l]) {
                t = r;
            }
    
            if (t != u) {
                swap(heap[t], heap[u]);
                u = t;
                l = 2 * u + 1;
                r = 2 * u + 2;
            } else {
                break;
            }
        }
    }
    
    void up(int u) {
        int fa = (u - 1) / 2;
    
        while (fa >= 0 && heap[fa] > heap[u]) {
            swap(heap[fa], heap[u]);
            u = fa;
            fa = (u - 1) / 2;
        }
    }
    
    int main() {
        cin >> n >> m;
        for (int i = 0; i < n; i++) {
            cin >> heap[i];
        }
        last = n - 1;
    
        // åˆå§‹åŒ–å †ç»“æ„ï¼ˆä»¥ä»ä¸Šå¾€ä¸‹ä¸ºä¾‹ï¼‰
        for (int i = n / 2; i >= 0; i--) {
            down(i);
        }
    
        // ä¹Ÿå¯ä»¥ä»ä¸‹å¾€ä¸Šåˆå§‹åŒ–
        // for (int i = 1; i < n; i++) {
        //     up(i);
        // }
    
        // è¾“å‡ºå †é¡¶ + é‡æ–°ç»´æŠ¤å †ç»“æ„
        for (int i = 0; i < m; i++) {
            cout << heap[0] << " ";
            heap[0] = heap[last--];
            down(0);
        }
    
        return 0;
    }
    ```

=== "C++ é€’å½’å†™æ³•"

    ```c++ hl_lines="9-34"
    #include <iostream>
    
    using namespace std;
    
    int n, m;
    int heap[100010];
    int last;
    
    void down(int u) {
        int l = 2 * u + 1;
        int r = 2 * u + 2;
    
        int t = u;
        if (l <= last && heap[u] > heap[l]) {
            t = l;
        }
        if (r <= last && heap[u] > heap[r] && heap[r] < heap[l]) {
            t = r;
        }
    
        if (t != u) {
            swap(heap[t], heap[u]);
            down(t);
        }
    }
    
    void up(int u) {
        int fa = (u - 1) / 2;
    
        if (fa >= 0 && heap[fa] > heap[u]) {
            swap(heap[fa], heap[u]);
            up(fa);
        }
    }
    
    int main() {
        cin >> n >> m;
        for (int i = 0; i < n; i++) {
            cin >> heap[i];
        }
        last = n - 1;
    
        // åˆå§‹åŒ–å †ç»“æ„ï¼ˆä»¥ä»ä¸Šå¾€ä¸‹ä¸ºä¾‹ï¼‰
        for (int i = n / 2; i >= 0; i--) {
            down(i);
        }
        
        // ä¹Ÿå¯ä»¥ä»ä¸‹å¾€ä¸Šåˆå§‹åŒ–
        // for (int i = 1; i < n; i++) {
        //     up(i);
        // }
    
        // è¾“å‡ºå †é¡¶ + é‡æ–°ç»´æŠ¤å †ç»“æ„
        for (int i = 0; i < m; i++) {
            cout << heap[0] << " ";
            heap[0] = heap[last--];
            down(0);
        }
    
        return 0;
    }
    ```

## å¹¶æŸ¥é›†

å¹¶æŸ¥é›† (Disjoint Set Union, DSU) ä¸€èˆ¬ç”¨æ¥è§£å†³é›†åˆé—®é¢˜ã€‚ä»£ç å®ç°ä¸Šï¼Œå¹¶æŸ¥é›†æ˜¯ä¸€ä¸ªç”±å¤šæ£µæœ‰å‘æ ¹æ ‘ç»„æˆçš„æ£®æ—ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src="https://cdn.dwj601.cn/images/20250614194500971.svg" alt="å¹¶æŸ¥é›†ç»“æ„ç¤ºæ„å›¾" style="zoom:200%;" />

**åˆå§‹åŒ–**ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªç»“ç‚¹éƒ½å­˜å‚¨äº†æŒ‡å‘çˆ¶ç»“ç‚¹çš„æŒ‡é’ˆï¼Œæ¯ä¸€æ£µæ ‘éƒ½è¡¨ç¤ºä¸€ä¸ªé›†åˆã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¹¶æŸ¥é›†çš„åˆå§‹åŒ–ä»£ç ï¼š

```python
class DSU:
    def __init__(self, n: int):
        """åˆå§‹åŒ–ä¸€ä¸ªå«æœ‰ n ä¸ªå…ƒç´ çš„å¹¶æŸ¥é›†ï¼Œå…ƒç´ ä¸‹æ ‡èŒƒå›´ä¸º [0, n-1]"""
        self.p = [i for i in range(n)]  # p[i] è¡¨ç¤º i å·ç‚¹çš„ç¥–å…ˆç»“ç‚¹ç¼–å·
        self.cnt = [1] * n  # cnt[i] è¡¨ç¤º i å·ç‚¹æ‰€åœ¨é›†åˆçš„å…ƒç´ ä¸ªæ•°
        self.set_cnt = n  # é›†åˆçš„ä¸ªæ•°
```

**å…ƒç´ æŸ¥è¯¢**ã€‚ä¸ºäº†æŸ¥è¯¢ä¸¤ä¸ªå…ƒç´  a å’Œ b æ˜¯å¦å±äºåŒä¸€ä¸ªé›†åˆï¼Œæœ€ç›´è§‚çš„æ–¹å¼å°±æ˜¯æŸ¥è¯¢ a å’Œ b çš„ç¥–å…ˆæ˜¯å¦ç›¸åŒã€‚æ˜¾ç„¶æˆ‘ä»¬å¯ä»¥å¾ªç€ p æ•°ç»„ä¸€è·¯å‘ä¸ŠæŸ¥ã€‚å¦‚ä¸‹å›¾çº¢è‰²è·¯å¾„æ‰€ç¤ºï¼š

<img src="https://cdn.dwj601.cn/images/20250614202404928.svg" alt="æœ´ç´ æŸ¥è¯¢" style="zoom:200%;" />

ä½†å¦‚æœæ ‘é€€åŒ–æˆäº†é“¾ï¼Œé‚£ä¹ˆå•æ¬¡æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å°±é€€åŒ–åˆ°äº† $O(n)$ã€‚è€ƒè™‘ã€Œè·¯å¾„å‹ç¼©ã€ï¼Œå³è°ƒæ•´æŸ¥è¯¢è·¯å¾„ä¸Šæ‰€æœ‰ç»“ç‚¹çš„ç¥–å…ˆç»“ç‚¹ä¸ºæ ¹ç»“ç‚¹ï¼š

![è·¯å¾„å‹ç¼©](https://cdn.dwj601.cn/images/20250614202541149.png)

è¿™æ ·åç»­æŸ¥è¯¢ã€Œä¹‹å‰æŸ¥è¿‡è·¯å¾„ä¸Šçš„ç»“ç‚¹ã€çš„ç¥–å…ˆç»“ç‚¹æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ $O(1)$ çš„äº†ã€‚

é€’å½’ç‰ˆä»£ç ç¤ºä¾‹ï¼š

=== "Python æœ´ç´ æŸ¥è¯¢"

    ```python
    def find(self, a: int) -> int:
        """è¿”å› a å·ç‚¹çš„ç¥–å…ˆç»“ç‚¹"""
        if self.p[a] == a:
            return a
        return self.find(self.p[a])
    ```

=== "Python è·¯å¾„å‹ç¼©"

    ```python
    def find(self, a: int) -> int:
        """è¿”å› a å·ç‚¹çš„ç¥–å…ˆç»“ç‚¹"""
        if self.p[a] != a:
            self.p[a] = self.find(self.p[a])
        return self.p[a]
    ```

è¿­ä»£ç‰ˆä»£ç ç¤ºä¾‹ï¼š

=== "Python æœ´ç´ æŸ¥è¯¢"

    ```python
    def find(self, a: int) -> int:
        """è¿”å› a å·ç‚¹çš„ç¥–å…ˆç»“ç‚¹"""
        while self.p[a] != a:
            a = self.p[a]
        return a
    ```

=== "Python è·¯å¾„å‹ç¼©"

    ```python
    def find(self, a: int) -> int:
        """è¿”å› a å·ç‚¹çš„ç¥–å…ˆç»“ç‚¹"""
        root = a
        # å…ˆæ‰¾åˆ°æ ¹ç»“ç‚¹
        while self.p[root] != root:
            root = self.p[root]
        # å†èµ°ä¸€éè¿›è¡Œè·¯å¾„å‹ç¼©
        while self.p[a] != a:
            a = self.p[a]
            self.p[a] = root
        return root
    ```

**é›†åˆåˆå¹¶**ã€‚ä¸ºäº†åˆå¹¶ç»“ç‚¹ a å’Œç»“ç‚¹ b æ‰€åœ¨çš„ä¸¤ä¸ªé›†åˆï¼Œä»£ç å®ç°ä¸Šå°±æ˜¯åˆå¹¶ç»“ç‚¹ a å’Œç»“ç‚¹ b æ‰€åœ¨çš„ä¸¤æ£µæ ‘ã€‚æ˜¾ç„¶ç»´æŠ¤æŸä¸€æ£µæ ‘çš„æ ¹ç»“ç‚¹ä¸ºå¦ä¸€é¢—æ ‘çš„æ ¹ç»“ç‚¹å³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

<img src="https://cdn.dwj601.cn/images/20250614204835305.svg" alt="é›†åˆåˆå¹¶" style="zoom:200%;" />

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåˆ°åº•è°â€œè‡£æœâ€äºè°ï¼Ÿè¿™é‡Œå¼•å‡ºäº†å¹¶æŸ¥é›†çš„å¦ä¸€ä¸ªä¼˜åŒ–æŠ€å·§ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ã€ŒæŒ‰ç§©åˆå¹¶ã€ï¼Œä¹Ÿå«ã€Œå¯å‘å¼åˆå¹¶ã€ã€‚è¿™é‡Œçš„â€œç§©â€å¯ä»¥æ˜¯æ ‘çš„æ·±åº¦ä¹Ÿå¯ä»¥æ˜¯æ ‘çš„ç»“ç‚¹æ•°é‡ï¼Œå³åº”å½“æ˜¯æ ‘çš„æ·±åº¦æ›´å°çš„æˆ–è€…æ ‘çš„ç»“ç‚¹æ•°æ›´å°‘çš„åˆå¹¶åˆ°å¦ä¸€æ£µæ ‘ä¸Šï¼Œä¸¤ç§åº¦é‡æ ‡å‡†å¸¦æ¥çš„æ—¶é—´å¼€é”€æ˜¯ä¸€è‡´çš„ [^dsu]ï¼Œå°±ä»¥æ ‘çš„å¤§å°ä¸ºä¾‹ï¼ˆæ‰€ä»¥å¦‚æœæŒ‰ç…§å¯å‘å¼åˆå¹¶çš„è§„åˆ™ï¼Œä¸Šå›¾åº”å½“æ˜¯å³è¾¹åˆå¹¶åˆ°å·¦è¾¹ï¼‰ã€‚ä»£ç å®ç°ä¸Šï¼š

=== "Python æœ´ç´ åˆå¹¶"

    ```python
    def merge(self, a: int, b: int) -> None:
        """åˆå¹¶ç»“ç‚¹ a å’Œç»“ç‚¹ b æ‰€åœ¨çš„é›†åˆ"""
        pa, pb = self.find(a), self.find(b)
        if pa == pb:
            return
        self.set_cnt -= 1
        # éšæ„åˆå¹¶ï¼Œä»¥å°† a æ‰€åœ¨é›†åˆåˆå¹¶åˆ° b æ‰€åœ¨é›†åˆä¸ºä¾‹
        self.p[pa] = pb
        self.cnt[pb] += self.cnt[pa]
    ```

=== "Python æŒ‰ç§©åˆå¹¶"

    ```python
    def merge(self, a: int, b: int) -> None:
        """åˆå¹¶ç»“ç‚¹ a å’Œç»“ç‚¹ b æ‰€åœ¨çš„é›†åˆ"""
        pa, pb = self.find(a), self.find(b)
        if pa == pb:
            return
        self.set_cnt -= 1
        # æŒ‰ç§©åˆå¹¶ï¼Œå°ç§©æ ‘åˆå¹¶åˆ°å¤§ç§©æ ‘
        if self.cnt[pa] < self.cnt[pb]:
            self.p[pa] = pb
            self.cnt[pb] += self.cnt[pa]
        else:
            self.p[pb] = pa
            self.cnt[pa] += self.cnt[pb]
    ```

[^dsu]: Gabow, H. N., & Tarjan, R. E. (1985). A Linear-Time Algorithm for a Special Case of Disjoint Set Union. JOURNAL OF COMPUTER AND SYSTEM SCIENCES, 30, 209-221.

### ä¾‹ï¼šMilk Visits S

> ç»å…¸ä¹‹å¤„ï¼šæ ‘é“¾ $\xrightarrow[]{åˆ‡æ¢è§†è§’}$ é›†åˆ
>
> éš¾åº¦ï¼šæ´›è°· ç»¿
>
> OJï¼š[æ´›è°·](https://www.luogu.com.cn/problem/P5836)

é¢˜æ„ï¼šç»™å®šä¸€æ£µå«æœ‰ $n\ (1\le n\le 10^5)$ ä¸ªç»“ç‚¹çš„æ ‘ï¼Œæ ‘ä¸Šçš„ç»“ç‚¹è¢«æ ‡è®°ä¸º $H$ å’Œ $G$ ä¸¤ç§ã€‚ç°åœ¨è¿›è¡Œ $m\ (1\le m\le 10^5)$ æ¬¡æŸ¥è¯¢ï¼Œæ¯æ¬¡æŸ¥è¯¢æ ‘ä¸Šä¸¤ä¸ªç»“ç‚¹ $u,v\ (1\le u,v\le n)$ çš„ç®€å•è·¯å¾„ä¸Šæ˜¯å¦å­˜åœ¨ $H$ æˆ– $G$ æ ‡è®°ï¼Œå¦‚æœå­˜åœ¨è¾“å‡º $1$ï¼Œåä¹‹è¾“å‡º $0$ã€‚

æ€è·¯ï¼šå¦‚ä½•å¿«é€Ÿåˆ¤æ–­æ ‘ä¸Šä»»æ„ä¸¤ç‚¹çš„ç®€å•è·¯å¾„ä¸Šæ˜¯å¦å­˜åœ¨æŸç§æ ‡è®°ï¼Ÿè€ƒè™‘ä½¿ç”¨å¹¶æŸ¥é›†å°†ã€Œç›¸åŒæ ‡è®°çš„ç›¸é‚»ç»“ç‚¹ã€è¿›è¡Œåˆå¹¶ã€‚åˆå¹¶åï¼Œå¦‚æœä¸¤ä¸ª $u,v$ ä¸åœ¨åŒä¸€ä¸ªé›†åˆï¼Œé‚£ä¹ˆè¯´æ˜ç®€å•è·¯å¾„ä¸Šä¸€å®šå­˜åœ¨ $H$ å’Œ $G$ ä¸¤ç§æ ‡è®°ï¼Œä¸€å®šå¯ä»¥æ»¡è¶³è¦æ±‚ï¼›åä¹‹å¦‚æœ $u,v$ åŒå±ä¸€ä¸ªé›†åˆï¼Œé‚£ä¹ˆåˆ¤æ–­å½“å‰é›†åˆå¯¹åº”çš„æ ‡è®°æ˜¯å¦æ»¡è¶³æŸ¥è¯¢å³å¯ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$

=== "Python"

    ```python
    class DSU:
        def __init__(self, n: int):
            """åˆå§‹åŒ–ä¸€ä¸ªå«æœ‰ n ä¸ªå…ƒç´ çš„å¹¶æŸ¥é›†ï¼Œå…ƒç´ ä¸‹æ ‡èŒƒå›´ä¸º [0, n-1]"""
            self.p = [i for i in range(n)]  # p[i] è¡¨ç¤º i å·ç‚¹çš„ç¥–å…ˆç»“ç‚¹ç¼–å·
            self.cnt = [1] * n  # cnt[i] è¡¨ç¤º i å·ç‚¹æ‰€åœ¨é›†åˆçš„å…ƒç´ ä¸ªæ•°
            self.set_cnt = n  # é›†åˆçš„ä¸ªæ•°
    
        def find(self, a: int) -> int:
            """è¿”å› a å·ç‚¹çš„ç¥–å…ˆç»“ç‚¹"""
            root = a
            # å…ˆæ‰¾åˆ°æ ¹ç»“ç‚¹
            while self.p[root] != root:
                root = self.p[root]
            # å†èµ°ä¸€éè¿›è¡Œè·¯å¾„å‹ç¼©
            while self.p[a] != a:
                a = self.p[a]
                self.p[a] = root
            return root
    
        def merge(self, a: int, b: int) -> None:
            """åˆå¹¶ç»“ç‚¹ a å’Œç»“ç‚¹ b æ‰€åœ¨çš„é›†åˆ"""
            pa, pb = self.find(a), self.find(b)
            if pa == pb:
                return
            self.set_cnt -= 1
            if self.cnt[pa] < self.cnt[pb]:
                self.p[pa] = pb
                self.cnt[pb] += self.cnt[pa]
            else:
                self.p[pb] = pa
                self.cnt[pa] += self.cnt[pb]
    
        def size(self, a: int) -> int:
            """è¿”å›ç»“ç‚¹ a æ‰€åœ¨é›†åˆçš„å…ƒç´ ä¸ªæ•°"""
            return self.cnt[self.find(a)]
    
        def size(self) -> int:
            """è¿”å›å¹¶æŸ¥é›†ä¸­é›†åˆçš„ä¸ªæ•°"""
            return self.set_cnt
    
        def same(self, a: int, b: int) -> bool:
            """åˆ¤æ–­ç»“ç‚¹ a å’Œç»“ç‚¹ b æ˜¯å¦åœ¨åŒä¸€ä¸ªé›†åˆä¸­"""
            return self.find(a) == self.find(b)


    from collections import deque
    
    # å¿«è¯»
    import sys
    input = lambda: sys.stdin.readline().strip()
    
    # å¤„ç†è¾“å…¥
    n, m = map(int, input().strip().split())
    label = ' ' + input().strip()
    g = [[] for _ in range(n + 1)]
    for _ in range(n - 1):
        u, v = map(int, input().strip().split())
        g[u].append(v)
        g[v].append(u)
    
    # åˆå¹¶æ ‘é“¾
    dsu = DSU(n + 1)
    q = deque()
    vis = [False] * (n + 1)
    q.append(1)
    vis[1] = True
    while len(q):
        now = q.popleft()
        for ch in g[now]:
            if vis[ch]:
                continue
            if label[now] == label[ch]:
                dsu.merge(now, ch)
            q.append(ch)
            vis[ch] = True
    
    # å¤„ç†æŸ¥è¯¢
    ans = ""
    for _ in range(m):
        u, v, lab = map(str, input().strip().split())
        u, v = int(u), int(v)
    
        if not dsu.same(u, v) or label[dsu.find(u)] == lab:
            ans += '1'
        else:
            ans += '0'
    print(ans)
    ```

### ä¾‹ï¼šå‡å°‘æ¶æ„è½¯ä»¶çš„ä¼ æ’­ IIğŸ¤¨

> ç»å…¸ä¹‹å¤„ï¼š
>
> éš¾åº¦ï¼šCF 1400 *
>
> OJï¼š[åŠ›æ‰£](https://leetcode.cn/problems/minimize-malware-spread-ii/description/)

é¢˜æ„ï¼šç»™å®šä¸€ä¸ªç”±é‚»æ¥çŸ©é˜µå­˜å‚¨çš„æ— å‘å›¾ï¼Œå…¶ä¸­æŸäº›ç»“ç‚¹å…·å¤‡æ„ŸæŸ“èƒ½åŠ›ï¼Œå¯ä»¥æ„ŸæŸ“ç›¸è¿çš„æ‰€æœ‰ç»“ç‚¹ï¼Œé—®åˆ é™¤å“ªä¸€ä¸ªå…·æœ‰æ„ŸæŸ“èƒ½åŠ›çš„ç»“ç‚¹å¯ä»¥ä½¿å¾—æœ€ç»ˆä¸è¢«æ„ŸæŸ“çš„ç»“ç‚¹æ•°é‡å°½å¯èƒ½å°‘ï¼Œç»™å‡ºåœ¨å›¾ä¸­çš„ç¼–å·æœ€å°çš„ç»“ç‚¹ç¼–å·ã€‚

*æ³¨ï¼šå¼±åŒ–ç‰ˆä»…ä¸ºæ¶ˆé™¤æ„ŸæŸ“èƒ½åŠ›ï¼Œè¿‡äºç®€å•ï¼Œè¿™é‡Œåªä»‹ç»å¢å¼ºç‰ˆã€‚

=== "Python"

    ```python
    
    ```

### ä¾‹ï¼šå…³æŠ¼ç½ªçŠ¯ğŸ¤¨

> ç»å…¸ä¹‹å¤„ï¼šå¸¦æƒå¹¶æŸ¥é›†
>
> éš¾åº¦ï¼šæ´›è°· ç»¿
>
> OJï¼š[æ´›è°·](https://www.luogu.com.cn/problem/P1525)

é¢˜æ„ï¼šç»™å®šä¸€ä¸ªå«æœ‰ $n\ (n\le2\cdot 10^4)$ ä¸ªé¡¶ç‚¹ $m\ (m\le10^5)$ æ¡è¾¹çš„æ— å‘å›¾ï¼Œæ²¡æœ‰é‡è¾¹å’Œè‡ªç¯ï¼Œè¾¹æƒ $w\ (1\le w_i\le 10^9)$ ä¸ºæ­£ã€‚ç°åœ¨éœ€è¦å°†å›¾ä¸­æ‰€æœ‰çš„é¡¶ç‚¹åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä½¿å¾—ä¸¤éƒ¨åˆ†ä¸­æœ€å¤§çš„è¾¹æƒå°½å¯èƒ½å°ï¼Œè¾“å‡ºè¯¥æœ€å°è¾¹æƒã€‚

æ€è·¯äºŒï¼šäºŒåˆ†å›¾ + äºŒåˆ†æŸ¥æ‰¾

- å‡è®¾ç­”æ¡ˆæ˜¯ $m$ æ¡è¾¹ä¸­æŸä¸€æ¡çš„æƒé‡ $w_i$ï¼Œé‚£ä¹ˆæ‰€æœ‰æƒé‡å°äº $w_i$ çš„è¾¹å¯¹åº”çš„é¡¶ç‚¹å¦‚ä½•åˆ†é…æ— å…³ç´§è¦ï¼Œæˆ‘ä»¬åªå…³æ³¨è¾¹æƒå¤§äº $w_i$ çš„è¾¹å¯¹åº”çš„é¡¶ç‚¹èƒ½ä¸èƒ½è¢«åˆ†åˆ°ä¸¤éƒ¨åˆ†ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªå…³å¿ƒè¾¹æƒå¤§äº $w_i$ çš„è¾¹å¯¹åº”çš„é¡¶ç‚¹ç»„æˆçš„å›¾æ˜¯å¦å¯äºŒåˆ†ã€‚é‡‡ç”¨æŸ“è‰²æ³•å³å¯å¿«é€Ÿåˆ¤å®šä¸€ä¸ªå›¾æ˜¯å¦å¯äºŒåˆ†ã€‚æ³¨æ„è¿™é‡Œçš„å¯äºŒåˆ†çš„å›¾å…¶å®ä¸ç¬¦åˆã€ŒäºŒåˆ†å›¾ã€çš„ä¸¥æ ¼å®šä¹‰ï¼Œå› ä¸ºä¸¤ä¸ªéƒ¨åˆ†çš„é¡¶ç‚¹ä¹‹é—´å¯èƒ½æœ‰è¿è¾¹ï¼›
- ç”±äº $w_i$ è¶Šå°éœ€è¦åˆ¤æ–­çš„é¡¶ç‚¹æ•°å°±è¶Šå¤šï¼Œå…·å¤‡äºŒåˆ†æ€§ã€‚å› æ­¤æˆ‘ä»¬ç›´æ¥åœ¨ $m$ æ¡è¾¹ä¸­äºŒåˆ†æŸ¥æ‰¾æœ€å°çš„ç¬¦åˆæ¡ä»¶çš„è¾¹å³å¯ï¼›
- æ—¶é—´å¤æ‚åº¦ï¼š$O(m\log n)$

æ€è·¯äºŒï¼šå¸¦æƒå¹¶æŸ¥é›†

- TODOï¼Œå‚è€ƒ [Blog](https://www.luogu.com.cn/article/kx2if31n)ã€‚

*[äºŒåˆ†å›¾]: åˆç§°äºŒéƒ¨å›¾ (Bipartite Graph)ã€‚å®šä¹‰ä¸ºï¼šèŠ‚ç‚¹ç”±ä¸¤ä¸ªé›†åˆç»„æˆï¼Œä¸”ä¸¤ä¸ªé›†åˆå†…éƒ¨æ²¡æœ‰è¾¹çš„å›¾ã€‚

=== "Python äºŒåˆ†å›¾ + äºŒåˆ†æŸ¥æ‰¾"

    ```cpp
    from collections import deque
    
    n, m = map(int, input().strip().split())
    edges = [(-1, -1, 0)]  # ä¸‹æ ‡ä» 1 å¼€å§‹
    for _ in range(m):
        u, v, w = map(int, input().strip().split())
        edges.append((u, v, w))
    
    edges.sort(key=lambda x: x[2])
    
    # æŸ“è‰²æ³• check äºŒåˆ†å›¾
    def chk(idx: int) -> bool:
        g = [[] for _ in range(n + 1)]
        for u, v, w in edges[idx + 1:]:
            g[u].append((v, w))
            g[v].append((u, w))
    
        color = [0] * (n + 1)
    
        def bfs(now: int) -> bool:
            color[now] = 1
            q = deque()
            q.append(now)
            while len(q):
                fa = q.popleft()
                for ch, _ in g[fa]:
                    if color[ch] == 0:
                        color[ch] = -color[fa]
                        q.append(ch)
                    elif color[ch] == color[fa]:
                        return False
            return True
    
        for i in range(1, n + 1):
            if color[i] == 0:
                ok = bfs(i)
                if not ok:
                    return False
        return True
    
    l, r = 0, m
    while l < r:
        mid = (l + r) >> 1
        if chk(mid):
            r = mid
        else:
            l = mid + 1
    
    print(edges[r][2])
    ```

=== "Python å¸¦æƒå¹¶æŸ¥é›†"

    ```python
    class DSU:
        def __init__(self, n: int) -> None:
            self.n = n
            self.sz = n                       # é›†åˆä¸ªæ•°
            self.p = [i for i in range(n)]    # p[i]è¡¨ç¤ºç¬¬iä¸ªç»“ç‚¹çš„ç¥–å®—ç¼–å·
            self.cnt = [1 for i in range(n)]  # cnt[i]è¡¨ç¤ºç¬¬iä¸ªç»“ç‚¹æ‰€åœ¨é›†åˆä¸­çš„ç»“ç‚¹æ€»æ•°
    
        def find(self, x: int) -> int:
            if self.p[x] != x:
                self.p[x] = self.find(self.p[x])
            return self.p[x]
    
        def merge(self, a: int, b: int) -> None:
            pa, pb = self.find(a), self.find(b)
            if pa != pb:
                self.p[pa] = pb
                self.cnt[pb] += self.cnt[pa]
                self.sz -= 1
    
        def same(self, a: int, b: int) -> bool:
            return self.find(a) == self.find(b)
    
        def size(self) -> int:
            return self.sz
    
        def size(self, a: int) -> int:
            return self.cnt[a]
    
    n, m = map(int, input().strip().split())
    edges = []
    for _ in range(m):
        u, v, w = map(int, input().strip().split())
        edges.append((u, v, w))
    
    edges.sort(key=lambda edge: -edge[2])
    dsu = DSU(n * 2 + 1)
    for u, v, w in edges:
        fu = dsu.find(u)
        fv = dsu.find(v)
        if fu == fv:
            print(w)
            exit()
        dsu.merge(u, v + n)
        dsu.merge(u + n, v)
    print(0)
    ```

åŒç±»é¢˜æ¨èï¼š

- [æ´›è°· ç»¿ | The Door Problem | æ´›è°· - (www.luogu.com.cn)](https://www.luogu.com.cn/problem/CF776D)
- [æ´›è°· ç»¿ | é£Ÿç‰©é“¾ | æ´›è°· - (www.luogu.com.cn)](https://www.luogu.com.cn/problem/P2024)
